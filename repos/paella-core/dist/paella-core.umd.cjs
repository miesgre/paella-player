(function(c,p){typeof exports=="object"&&typeof module<"u"?p(exports):typeof define=="function"&&define.amd?define(["exports"],p):(c=typeof globalThis<"u"?globalThis:c||self,p(c["paella-core"]={}))})(this,function(c){"use strict";var sn=c=>{throw TypeError(c)};var an=(c,p,T)=>p.has(c)||sn("Cannot "+T);var h=(c,p,T)=>(an(c,p,"read from private field"),T?T.call(c):p.get(c)),A=(c,p,T)=>p.has(c)?sn("Cannot add the same private member more than once"):p instanceof WeakSet?p.add(c):p.set(c,T),M=(c,p,T,E)=>(an(c,p,"write to private field"),E?E.call(c,T):p.set(c,T),T);var Te,F,Q,Y,Ie,oe,k,R,De,ke,ge,me,Z,fe,Ae,ye,x,le,ve;const p=Object.freeze({PLAY:"paella:play",PAUSE:"paella:pause",STOP:"paella:stop",ENDED:"paella:ended",SEEK:"paella:seek",FULLSCREEN_CHANGED:"paella:fullscreenchanged",ENTER_FULLSCREEN:"paella:enterfullscreen",EXIT_FULLSCREEN:"paella:exitfullscreen",VOLUME_CHANGED:"paella:volumeChanged",TIMEUPDATE:"paella:timeupdate",TRIMMING_CHANGED:"paella:trimmingChanged",CAPTIONS_CHANGED:"paella:captionsChanged",CAPTIONS_ENABLED:"paella:captionsEnabled",CAPTIONS_DISABLED:"paella:captionsDisabled",BUTTON_PRESS:"paella:buttonPress",SHOW_POPUP:"paella:showPopUp",HIDE_POPUP:"paella:hidePopUp",MANIFEST_LOADED:"paella:manifestLoaded",STREAM_LOADED:"paella:streamLoaded",PLAYER_LOADED:"paella:playerLoaded",PLAYER_UNLOADED:"paella:playerUnloaded",RESIZE:"paella:resize",RESIZE_END:"paella:resizeEnd",LAYOUT_CHANGED:"paella:layoutChanged",PLAYBACK_RATE_CHANGED:"paella:playbackRateChanged",VIDEO_QUALITY_CHANGED:"paella:videoQualityChanged",HIDE_UI:"paella:hideUI",SHOW_UI:"paella:showUI",COOKIE_CONSENT_CHANGED:"paella:cookieConsentChanged",LOG:"paella:log"});function T(n,e,t,i=!0){return n.__eventListeners__=n.__eventListeners__||{},Array.isArray(e)||(e=[e]),e.forEach(s=>{n.__eventListeners__[s]=n.__eventListeners__[s]||[],n.__eventListeners__[s].push({callback:t,unregisterOnUnload:i})}),t}function E(n,e,t={}){n.__eventListeners__&&n.__eventListeners__[e]&&n.__eventListeners__[e].forEach(i=>i.callback(t))}function ee(n,e,t={}){n.ready&&E(n,e,t)}function rn(n){if(n.__eventListeners__)for(const e in n.__eventListeners__)n.__eventListeners__[e]=n.__eventListeners__[e].filter(t=>t.unregisterOnUnload==!1),n.log.debug("Unregister event: "+n.__eventListeners__[e])}function Mt(n){return new Promise((e,t)=>{fetch(n).then(i=>i.text()).then(i=>{e(i)}).catch(i=>t(i))})}function Rt(n){const e=new URLSearchParams(window.location.search);return e.has(n)?e.get(n):null}function xt(n){const e=window.location.hash.replace("#","?"),t=new URLSearchParams(e);return t.has(n)?t.get(n):null}function G(n,e){const t=e||"/";return n=n.map((i,s)=>(s&&(i=i.replace(new RegExp("^"+t),"")),s!==n.length-1&&(i=i.replace(new RegExp(t+"$"),"")),i)),n.join(t)}function Vt(n){return new RegExp("^([a-z]+://|//)","i").test(n)||/^\//.test(n)}function Me(n){try{return new URL(n).pathname.split("/").pop()}catch{return n.split("/").pop()}}function Ut(n){return n.split(".").reduce((e,t,i,s)=>i<s.length-1?e!==""?`${e}.${t}`:t:e,"")}function He(n){const e=t=>{const i=t.split("/").reduce((s,a,r,o)=>r<o.length-1?s!==""?`${s}/${a}`:a:s,"");return(t[0]==="/"?`/${i}`:i)+"/"};try{const t=new URL(n);return t.origin+e(t.pathname)}catch{return e(n)}}function je(n){return Me(n).split(".").pop()}function H(n,e){return Vt(e)?e:G([n.manifestUrl,e])}function Nt(n){n.__hideTimerPaused__=!0}function Ft(n){n.__hideTimerPaused__=!1}function Ot(n,e="hideUiTime"){var a;n.__hideTimer__=null;const t=async()=>n.__hideTimerPaused__?(n.log.debug("UI not hidden because the auto hide timer is paused"),!1):i()?(n.log.debug("UI not hidden because there is a focused element"),!1):(await n.hideUserInterface(),!0);(a=n.config.ui)!=null&&a.hideOnMouseLeave&&n.containerElement.addEventListener("mouseleave",()=>{t()});const i=()=>{const r=document.activeElement;return(n.playbackBar.element.contains(r)||n.videoContainer.element.contains(r))&&["input","textarea","button"].find(o=>r.tagName.toLowerCase(o))!==-1},s=async()=>{n.__hideTimer__&&clearTimeout(n.__hideTimer__),await n.showUserInterface(),n.__hideTimer__=setTimeout(async()=>{n.__hideTimer__=null,t()||s()},n[e])};n.containerElement.addEventListener("mousemove",async r=>{s()}),T(n,p.PLAY,async()=>{s()}),T(n,p.PAUSE,async()=>{await n.showUserInterface()}),T(n,p.ENDED,async()=>{await n.showUserInterface()}),document.addEventListener("keydown",async()=>{s()})}function $t(n){n.__hideTimer__&&(clearTimeout(n.__hideTimer__),delete n.__hideTimer__)}function te(n){const e=Math.floor(n/60/60),t=Math.floor(n/60)-e*60,i=Math.floor(n%60);return(e>0?e.toString().padStart(2,"0")+":":"")+t.toString().padStart(2,"0")+":"+i.toString().padStart(2,"0")}function Re(n){const t=/^(?:(\d+):){0,1}(\d+):(\d+)(\.\d+)?$/.exec(n);if(t){const i=t[1]!==void 0?Number(t[1]):0,s=Number(t[2]),a=Number(t[3]);return i*3600+s*60+a}return null}function We(n){const t=/^(?:(\d+):){0,1}(\d+):(\d+)\.(\d+)?$/.exec(n);if(t){const i=t[1]!==void 0?Number(t[1]):0,s=Number(t[2]),a=Number(t[3]),r=t[4]&&Number(t[4])||0;return i*36e5+s*6e4+a*1e3+r}return null}function ie(n,e,t=365){let i=new Date;i.setTime(i.getTime()+t*24*60*60*1e3);let s=`expires=${i.toUTCString()}`;document.cookie=`${n}=${e};${s};path=/;SameSite=None;`+(/Apple/.test(navigator.vendor)?"":"Secure;")}function Bt(n,e,t,i,s=365){n.cookieConsent.getConsentForType(e)&&ie(t,i,s)}function j(n){let e=n+"=",i=decodeURIComponent(document.cookie).split(";");for(let s=0;s<i.length;++s){let a=i[s];for(;a.charAt(0)==" ";)a=a.substring(1);if(a.indexOf(e)==0)return a.substring(e.length,a.length)}return""}function on(n){const e=j(n),t=Number(e);return e!==""&&!isNaN(t)?t:null}function ln(n){try{return JSON.parse(j(n))}catch{return null}}function qe(n,e=!0){return new Promise(t=>{const i=document.createElement("link");i.setAttribute("rel","stylesheet"),i.setAttribute("href",n),i.onload=()=>t(i);const s=document.getElementsByTagName("head")[0];e&&s.appendChild(i),t()})}function Gt(n){document.getElementsByTagName("head")[0].removeChild(n)}function _e(n,e,t=!0){for(const i in e){const s=n[i];let a=e[i];t&&Array.isArray(s)&&Array.isArray(a)?(s.forEach(r=>{a=a.filter(o=>typeof r=="object"&&typeof o=="object"&&r.id===o.id?(_e(r,o,t),!1):!0)}),a.forEach(r=>{s.push(r)})):typeof s=="object"&&a?_e(s,a,t):n[i]=e[i]}}function zt(n,{excludedTags:e=null}={}){const t=document.createElement("div");t.innerHTML=n;const i=["script"];return e&&i.push(...e),i.flatMap(s=>Array.from(t.getElementsByTagName(s))).forEach(s=>{s.parentElement.removeChild(s)}),t.innerHTML}let xe=null;function Qe(n){if(!n)return!1;xe||(xe=document.createElement("video"));let e=xe.canPlayType(n);if(e==="maybe"||e==="probably")return!0;if(/video\/mp4/i.test(n))return e=xe.canPlayType("video/mp4"),e==="maybe"||e==="probably"}const cn=Object.freeze(Object.defineProperty({__proto__:null,clearAutoHideTimer:$t,getCookie:j,getFileExtension:je,getHashParameter:xt,getJSONCookie:ln,getNumericCookie:on,getUrlFileName:Me,getUrlParameter:Rt,isAbsoluteUrl:Vt,joinPath:G,loadStyle:qe,loadSvgIcon:Mt,mergeObjects:_e,pauseAutoHideUiTimer:Nt,removeExtension:Ut,removeFileName:He,resolveResourcePath:H,resumeAutoHideUiTimer:Ft,sanitizeHTML:zt,secondsToTime:te,setCookie:ie,setCookieIfAllowed:Bt,setupAutoHideUiTimer:Ot,supportsVideoType:Qe,timeToMilliseconds:We,timeToSeconds:Re,unloadStyle:Gt},Symbol.toStringTag,{value:"Module"}));async function Ht(n,e){return e.log.debug("Using default configuration loading function."),(await fetch(n)).json()}async function jt(n,e){return e.log.debug("Using default getVideoId function"),xt("id")||Rt("id")||n.fallbackId}async function Wt(n,e,t,i){return i.log.debug("Using default getManifestUrl function"),G([n,e])}async function qt(n,e,t,i){return i.log.debug("Using default getManifestFileUrl function"),G([n,e])}async function Qt(n,e,t){t.log.debug("Using default loadVideoManifest function");const i=await fetch(n);if(i.ok)return await i.json();throw new Error(t.translate("Error loading video manifest: $1 $2",[i.status,i.statusText]))}class ne{constructor(e){A(this,Te,null);M(this,Te,e)}get player(){return h(this,Te)}}Te=new WeakMap;function Ye({tag:n="div",attributes:e={},children:t="",innerText:i="",parent:s=null}){const a=document.createElement(n);a.innerText=i;for(let r in e)a.setAttribute(r,e[r]);return a.innerHTML=t,s&&s.appendChild(a),a}function b(n,e=null){const t=document.createElement("div");t.innerHTML=n;const i=t.children[0];return e&&e.appendChild(i),i}class O extends ne{constructor(t,{tag:i="div",attributes:s=[],children:a="",parent:r=null}){super(t);A(this,F,null);M(this,F,Ye({tag:i,attributes:s,children:a,parent:r})),Object.defineProperty(this,i,{get:()=>h(this,F)})}get element(){return h(this,F)}get parent(){return h(this,F).parentElement}hide(){this.element.style.display="none"}show(t="block"){this.element.style.display=null}get isVisible(){const t=window.getComputedStyle(this.element);return t.display!=="none"&&t.display!==""}setAttribute(t,i){h(this,F).setAttribute(t,i)}removeFromParent(){var t;(t=h(this,F).parentElement)==null||t.removeChild(h(this,F))}setParent(t){this.removeFromParent(),t.appendChild(h(this,F))}}F=new WeakMap;const un=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="100%" height="100%" viewBox="0 0 256 256" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
    <g transform="matrix(1,0,0,1,3,-3.88857)">
        <path d="M128,35.819C65.633,35.819 14.999,86.453 14.999,148.82C14.999,163.127 17.663,176.817 22.549,189.403L22.475,189.447C11.612,170.791 5.889,149.588 5.889,128C5.889,60.56 60.56,5.889 128,5.889L128,35.819Z" style="fill:url(#_Linear1);"/>
    </g>
    <g transform="matrix(-1,1.22465e-16,-1.22465e-16,-1,258,251.914)">
        <path d="M128,35.819C65.633,35.819 14.999,86.453 14.999,148.82C14.999,163.127 17.663,176.817 22.549,189.403L22.475,189.447C11.612,170.791 5.889,149.588 5.889,128C5.889,60.56 60.56,5.889 128,5.889L128,35.819Z" style="fill:url(#_Linear2);"/>
    </g>
    <defs>
        <linearGradient id="_Linear1" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="matrix(-89.3028,140.734,-140.734,-89.3028,144.417,48.7125)"><stop offset="0" style="stop-color:rgb(13,13,13);stop-opacity:1"/><stop offset="1" style="stop-color:rgb(175,175,175);stop-opacity:0.5"/></linearGradient>
        <linearGradient id="_Linear2" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="matrix(-89.3028,140.734,-140.734,-89.3028,144.417,48.7125)"><stop offset="0" style="stop-color:rgb(13,13,13);stop-opacity:1"/><stop offset="1" style="stop-color:rgb(175,175,175);stop-opacity:0.5"/></linearGradient>
    </defs>
</svg>
`;class Yt extends O{constructor(e){super(e,{parent:e.containerElement}),this.element.className="loader-container"}async create(){b(`<i>${un}</i>`,this.element)}get debug(){return!1}}const dn=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="100%" height="100%" viewBox="0 0 256 256" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
    <g id="Cancel" transform="matrix(5.54545,6.8353e-32,6.8353e-32,5.54545,-2567.37,-10735.5)">
        <path d="M486.05,1937C498.192,1937 508.05,1946.86 508.05,1959C508.05,1971.14 498.192,1981 486.05,1981C473.908,1981 464.05,1971.14 464.05,1959C464.05,1946.86 473.908,1937 486.05,1937ZM478.979,1950.52L477.565,1951.93L484.636,1959L477.565,1966.07L478.979,1967.49L486.05,1960.41L493.121,1967.49L494.535,1966.07L487.464,1959L494.535,1951.93L493.121,1950.52L486.05,1957.59L478.979,1950.52Z" style="fill:rgb(210,0,0);"/>
    </g>
</svg>
`;class Ze extends O{constructor(e,t=""){super(e,{parent:e.containerElement}),this.element.className="error-container",b(`
            <div>
                <i>${dn}</i>
                <p>${t}</p>
            </div>`,this.element)}}class se extends ne{constructor(e,t){super(e),this._name=t}getPluginModuleInstance(){return null}get config(){return this._config}get type(){return"none"}get order(){var e;return((e=this._config)==null?void 0:e.order)||0}get description(){var e;return((e=this._config)==null?void 0:e.description)||""}get name(){return this._name}async isEnabled(){var e;return(e=this.config)==null?void 0:e.enabled}async load(){}async unload(){}}class we extends se{get type(){return"video"}get streamType(){return"mp4"}async isCompatible(){return!1}async getVideoInstance(){return null}getCompatibleFileExtensions(){return[]}getManifestData(e){}}const Ve=[];async function hn(n){await V(n,"video",e=>{Ve.push(e)})}async function pn(n){Ve.slice(0)}function Zt(n){if(Ve.length===0)throw Error("No video plugins loaded. Note that `loadVideoPlugins()` must to be called before using `getVideoPlugins()`.");return Ve}function gn(n,e){const t=je(e);return Zt().find(s=>s.getCompatibleFileExtensions().indexOf(t)!==-1)}async function mn(n,e){const t=Zt();let i=null;for(const s of t)if(await s.isCompatible(e)){i=s;break}return i}async function Kt(){return await new Promise(e=>{const t=document.createElement("audio"),i=setTimeout(()=>e(!1),100);t.addEventListener("volumechange",s=>{clearTimeout(i),e(!0)}),t.volume=.5})}class Ue extends O{constructor(e,t,i){const s={class:"video-player"};super(t,{tag:e,attributes:s,parent:i}),this._streamProvider=null,this._streamData=null,this._ready=!1}async isVolumeApiAvailable(){return await Kt()}get streamData(){return this._streamData}get ready(){return this._ready}async load(e,t){return this._streamProvider=t,this._streamData=e,await this.loadStreamData(e)}get isMainAudioPlayer(){return this._streamProvider.mainAudioPlayer===this}onVideoEnded(e){this._videoEndedCallback=e}async play(){return!1}async pause(){return!1}async duration(){return-1}get currentTimeSync(){return-1}async currentTime(){return-1}async setCurrentTime(){return!1}async volume(){return-1}async setVolume(){return!1}initVolume(e){this._initialVolume=e}async paused(){return!0}async playbackRate(){return-1}async setPlaybackRate(){return!1}async getQualities(){return null}async setQuality(){return!1}get currentQuality(){return null}async getDimensions(){return null}async supportsMultiaudio(){return!1}async getAudioTracks(){return null}async setCurrentAudioTrack(){}get currentAudioTrack(){return null}async loadStreamData(e){return!1}get isEnabled(){return this._enabled}async enable(){this._enabled=!0}async disable(){this._enabled=!1}}class Ce extends ne{get moduleName(){return this.player.log.warn(`Incomplete player module definition: '${__filename}.moduleName'`),"-"}get moduleVersion(){return this.player.log.warn(`Incomplete player module definition: '${__filename}.moduleVersion'`),"0.0.0"}async getDictionaries(){return null}}const be={name:"@asicupv/paella-core",exports:{".":"./dist/paella-core.js","./src/":"./src/","./paella-core.css":"./dist/paella-core.css"},version:"2.0.2",description:"Multi stream HTML video player",main:"./dist/paella-core.js",files:["dist/paella-core.css","dist/paella-core.js","dist/paella-core.umd.cjs","dist/paella-core.js.map","dist/paella-core.umd.cjs.map"],module:"./dist/paella-core.js",type:"module",scripts:{dev:"vite",build:"vite build --emptyOutDir"},repository:{type:"git",url:"git+https://github.com/polimediaupv/paella-player.git"},keywords:["html","player","video","hls"],author:"Fernando Serrano Carpena <ferserc1@gmail.com>",license:"ECL-2.0",bugs:{url:"https://github.com/polimediaupv/paella-player/issues"},homepage:"https://github.com/polimediaupv/paella-player#readme",devDependencies:{vite:"^6.0.11"},dependencies:{"@ferserc1/input-style-unifier":"^0.0.2"}};let Ke=null;class ue extends Ce{static Get(){return Ke||(Ke=new ue),Ke}get moduleName(){return"paella-core default video formats"}get moduleVersion(){return be.version}}function fn(n){return new Promise((e,t)=>{const i=new Image;i.addEventListener("load",s=>{e(i)}),i.addEventListener("error",s=>{t(new Error("Could not load preview image. The preview image is required in audio only streams"))}),i.src=n})}function yn(n,e,t){return new Promise((i,s)=>{e.oncanplay=()=>i(),e.onerror=()=>s(new Error(n.translate("Error loading audio: $1",[t]))),e.src=H(n,t),i()})}class Jt extends Ue{constructor(e,t,i){super("audio",e,t),this.isMainAudio=i,this._ready=!1}get streamType(){return"audio"}waitForLoaded(){return new Promise(e=>{const t=()=>{this._ready?e():setTimeout(t,100)};t()})}async play(){await this.waitForLoaded(),this.audio.play()}async pause(){await this.waitForLoaded(),this.audio.pause()}async duration(){return await this.waitForLoaded(),this.audio.duration}get currentTimeSync(){var e;return((e=this.audio)==null?void 0:e.currentTime)||0}async currentTime(){return await this.waitForLoaded(),this.audio.currentTime}async setCurrentTime(e){await this.waitForLoaded(),this.audio.currentTime=e}async volume(){return await this.waitForLoaded(),this.audio.volume}async setVolume(e){await this.waitForLoaded(),this.audio.volume=e}async paused(){return await this.waitForLoaded(),this.audio.paused}async playbackRate(){return await this.waitForLoaded(),this.audio.playbackRate}async setPlaybackRate(e){await this.waitForLoaded(),this.audio.playbackRate=e}async getDimensions(){return{w:this._previewImage.width,h:this._previewImage.height}}async loadStreamData(e=null){this._streamData=this._streamData||e,this.player.log.debug("es.upv.paella.audioVideoFormat: loadStreamData");const t=this.player.videoManifest.metadata.preview;if(!t||t==null)throw new Error("Invalid video manifest data: preview image is required");if(this._previewImage=await fn(t),this._imageContainer=document.createElement("div"),this._imageContainer.className="image-container",this.parent.appendChild(this._imageContainer),this._imageContainer.appendChild(this._previewImage),this._source=e.sources.audio&&e.sources.audio[0],!this._source)throw new Error("Invalid source in audio only video stream");if(!this.isMainAudioPlayer)throw new Error("Audio only video stream must be main audio player. Check the role property at video manifest");await yn(this.player,this.audio,this._source.src);const i=()=>{const s=this.player.videoContainer.baseVideoRect.offsetWidth/this.player.videoContainer.baseVideoRect.offsetHeight,a=this._previewImage.width/this._previewImage.height;s>a?(this._previewImage.classList.add("landscape"),this._previewImage.classList.remove("portrait")):(this._previewImage.classList.add("portrait"),this._previewImage.classList.remove("landscape"))};this.player.frameList.frames.length>0&&this.audio.addEventListener("timeupdate",s=>{const a=this.player.frameList.getImage(s.target.currentTime,!0);this._previewImage.src!=a.url&&(this._previewImage.src=a.url,this._previewImage.onload=()=>i())}),window.addEventListener("resize",s=>i()),i(),this._ready=!0}}class Xt extends we{getPluginModuleInstance(){return ue.Get()}get name(){return super.name||"es.upv.paella.audioVideoFormat"}get streamType(){return"audio"}async isCompatible(e){return e.sources.audio!=null}async getVideoInstance(e,t){return new Jt(this.player,e,t)}getCompatibleFileExtensions(){return["m4a","mp3"]}getManifestData(e){return{audio:e.map(t=>({src:t}))}}}class Je extends Ue{constructor(e,t,i,s){super("video",e,t),this._config=s||{};const a=this._config.crossOrigin??"";this.element.setAttribute("playsinline",""),a!==!1&&this.element.setAttribute("crossorigin",a),this.isMainAudio=i,this.element.setAttribute("autoplay",""),this.element.autoplay=!0,i||(this.element.muted=!0),this._videoEnabled=!0}async play(){if(this._videoEnabled)try{return await this.waitForLoaded(),this.video.play()}catch{}else this._disabledProperties.paused=!1}async pause(){if(this._videoEnabled)return await this.waitForLoaded(),this.video.pause();this._disabledProperties.paused=!0}async duration(){return this._videoEnabled?(await this.waitForLoaded(),this.video.duration):this._disabledProperties.duration}get currentTimeSync(){return this._videoEnabled?this.ready?this.video.currentTime:-1:this._disabledProperties.currentTime}async currentTime(){return this._videoEnabled?(await this.waitForLoaded(),this.currentTimeSync):this._disabledProperties.currentTime}async setCurrentTime(e){return this._videoEnabled?(await this.waitForLoaded(),this.video.currentTime=e):(this._disabledProperties.currentTime=e,e)}async volume(){return this._videoEnabled?(await this.waitForLoaded(),this.video.volume):this._disabledProperties.volume}async setVolume(e){return this._videoEnabled?(await this.waitForLoaded(),e===0?this.video.setAttribute("muted",""):this.video.removeAttribute("muted"),this.video.volume=e):(this._disabledProperties.volume=e,e)}async paused(){return this._videoEnabled?(await this.waitForLoaded(),this.video.paused):this._disabledProperties.paused}async playbackRate(){return this._videoEnabled?(await this.waitForLoaded(),await this.video.playbackRate):this._disabledProperties.playbackRate}async setPlaybackRate(e){return this._videoEnabled?(await this.waitForLoaded(),this.video.playbackRate=e):(this._disabledProperties.playbackRate=e,e)}async getQualities(){}async setQuality(){}get currentQuality(){return 0}async getDimensions(){return this._videoEnabled?(await this.waitForLoaded(),{w:this.video.videoWidth,h:this.video.videoHeight}):{w:this._disabledProperties.videoWidth,h:this._disabledProperties.videoHeight}}saveDisabledProperties(e){this._disabledProperties={duration:e.duration,volume:e.volume,videoWidth:e.videoWidth,videoHeight:e.videoHeight,playbackRate:e.playbackRate,paused:e.paused,currentTime:e.currentTime}}async loadStreamData(e=null){this._streamData=this._streamData||e,this.player.log.debug("es.upv.paella.htmlVideoFormat: loadStreamData"),this._sources=e.sources.html,this._currentQuality=0,this.isMainAudioPlayer||(this.video.muted=!0),this._sources.forEach(({src:t,mimetype:i})=>{t=H(this.player,t);const s=document.createElement("source");s.src=t,s.type=i,this.video.appendChild(s)}),this._endedCallback=this._endedCallback||(()=>{typeof this._videoEndedCallback=="function"&&this._videoEndedCallback()}),this.video.addEventListener("ended",this._endedCallback);try{await this.video.play()}catch{}await this.waitForLoaded(),this.player.log.debug(`es.upv.paella.htmlVideoFormat (${this.streamData.content}): video loaded and ready.`),this.saveDisabledProperties(this.video)}async clearStreamData(){this.video.src="",this.video.removeEventListener("ended",this._endedCallback),this.video.removeEventListener("loadeddata",this._handleLoadedCallback),this._ready=!1}get isEnabled(){return this._videoEnabled}async enable(){this._videoEnabled=!0}async disable(){return this.isMainAudio?this.player.log.debug("video.disable() - the video is not disabled because it is the main audio source."):this._videoEnabled=!1,this._videoEnabled}waitForLoaded(){return new Promise((e,t)=>{this.video.readyState>=2&&(this._ready=!0),this.ready?e():(this._handleLoadedCallback=i=>{this.video.readyState>=2&&(this.video.pause(),this._ready=!0,e())},this.video.addEventListener("loadeddata",this._handleLoadedCallback))})}}class ei extends we{getPluginModuleInstance(){return ue.Get()}get name(){return super.name||"es.upv.paella.htmlVideoFormat"}get streamType(){return"html"}async isCompatible(e){const{html:t}=e.sources;return t&&t.some(i=>Qe(i.mimetype))}async getVideoInstance(e,t){return new Je(this.player,e,t,this.config)}getCompatibleFileExtensions(){return["m4v","mp4","ogg","webm","ogv"]}getManifestData(e){const t=i=>{switch(je(i)){case"mp4":case"m4v":return"video/mp4";case"webm":return"video/webm";case"ogg":case"ogv":return"video/ogg";default:return null}};return{html:e.map(i=>({src:i,mimetype:t(i)}))}}}class ti{constructor({label:e,shortLabel:t,isAuto:i=!1,index:s=0,src:a="",width:r=-1,height:o=-1,bitrate:l=-1}){this._label=e,this._shortLabel=t,this._index=s,this._src=a,this._res={w:r,h:o},this._bitrate=l,this._isAuto=i}get label(){return this._label}get shortLabel(){return this._shortLabel}get index(){return this._index}get src(){return this._src}get res(){return this._res}get bitrate(){return this._bitrate}get isAuto(){return this._isAuto}get quality(){return this._res.w!==-1&&this._res.h!==-1?this._res.w*this._res.h:this._bitrate}compare(e){return e.quality-this.quality}}function ii(n){let e=this._currentSource.frames[0];this._currentSource.frames.some(t=>{if(t.time<=this._currentTime)e=t;else return!0}),this.img.src=e.src}function vn(){this._startTimestamp=Date.now();const n=()=>{this._timer=setTimeout(n,250);const e=Date.now(),t=e-this._startTimestamp;this._currentTime+=t/1e3,this._startTimestamp=e,ii.apply(this,[this._currentTime])};n()}function _n(){this._timer&&(clearTimeout(this._timer),this._timer=null)}class ni extends Ue{constructor(e,t){super("img",e,t),this._currentTime=0,this._startTimesamp=0,this._playbackRate=1,this._timer=null,this.video=this.domElement}async play(){vn.apply(this)}async pause(){_n.apply(this)}async duration(){return this._currentSource.duration}get currentTimeSync(){return this._currentTime}async currentTime(){return this._currentTime}async setCurrentTime(e){this._currentTime=e,ii.apply(this,[e])}async volume(){return 0}async setVolume(e){}async paused(){return this._timer===null}async playbackRate(){return this._playbackRate}async setPlaybackRate(e){this._playbackRate=e}async getQualities(){return this._qualities}async setQuality(){}get currentQuality(){return this._currentQuality}async getDimensions(){return this._currentSource.res}async loadStreamData(e){return this._sources=e.sources.image,this._qualities=this._sources.map(t=>new ti({src:t.frames[0].src,label:`${t.res.w}x${t.res.h}`,shortLabel:`${t.res.h}p`,width:t.res.w,height:t.res.h})),this._currentQuality=this._qualities.length-1,this._qualities.forEach((t,i)=>{this._qualities[this._currentQuality].compare(t)>0&&(this._currentQuality=i)}),this._currentSource=this._sources[this._currentQuality],this._sources.forEach(t=>{t.frames.sort((i,s)=>i.time-s.time)}),!0}}class si extends we{getPluginModuleInstance(){return ue.Get()}get name(){return super.name||"es.upv.paella.imageVideoFormat"}get streamType(){return"image"}async isCompatible(e){return e.sources.image!=null}async getVideoInstance(e,t){return new ni(this.player,e,this.config,t)}}class ai extends Je{constructor(e,t,i,s){super(e,t,i,s)}async loadStreamData(e=null){this._streamData=this._streamData||e,this.player.log.debug("es.upv.paella.mp4VideoFormat: loadStreamData"),this._currentSource||(this._sources=null,this._currentQuality=0,this._sources=e.sources.mp4,this._sources.sort((t,i)=>Number(t.res.w)-Number(i.res.w)),this._currentQuality=this._sources.length-1,this._currentSource=this._sources[this._currentQuality]),this.isMainAudioPlayer||(this.video.muted=!0),this._initialVolume&&(this.video.volume=this._initialVolume,this._initialVolume===0&&(this.video.muted=!0)),this.video.src=H(this.player,this._currentSource.src),this._endedCallback=this._endedCallback||(()=>{typeof this._videoEndedCallback=="function"&&this._videoEndedCallback()}),this.video.addEventListener("ended",this._endedCallback);try{await this.video.play()}catch{}await this.waitForLoaded(),this.player.log.debug(`es.upv.paella.mp4VideoFormat (${this.streamData.content}): video loaded and ready.`),this.saveDisabledProperties(this.video)}}class ri extends we{getPluginModuleInstance(){return ue.Get()}get name(){return super.name||"es.upv.paella.mp4VideoFormat"}get streamType(){return"mp4"}isCompatible(e){var i;const{mp4:t}=e.sources;return t&&Qe((i=t[0])==null?void 0:i.mimetype)}async getVideoInstance(e,t){return new ai(this.player,e,t,this.config)}getCompatibleFileExtensions(){return["m4v","mp4"]}getManifestData(e){return{mp4:e.map(t=>({src:t,mimetype:"video/mp4"}))}}}async function wn(n){const e=[];await V(n,"captions",async t=>{e.push(t)});for(let t in e){const s=await e[t].getCaptions(),a=n.captionsCanvas;s.forEach(r=>a.addCaptions(r))}}class Xe extends se{get type(){return"captions"}async load(){this.player.log.debug("load captions plugin")}async getCaptions(){return this.player.log.warn(`CaptionsPlugin ${this.name}: getCaptions() is not implemented.`),[]}}class et{get cues(){return this._cues}get label(){return this._label}get language(){return this._lang}set label(e){this._label=e}set language(e){this._lang=e}constructor(e="",t=""){this._cues=[],this._label=e,this._lang=t}addCue({label:e="",start:t,end:i,captions:s}){const a={label:e};if(typeof s=="string")a.captions=[s];else if(Array.isArray(s))a.captions=s;else throw Error("Invalid cue caption format: must be an array of strings or a string");if(typeof t=="string")a.start=Re(t),a.startString=t;else if(typeof t=="number")a.start=t,a.startString=te(t);else throw Error("Invalid cue timestamp format: must be a valid time string or a number of seconds");if(typeof i=="string")a.end=Re(i),a.endString=i;else if(typeof i=="number")a.end=i,a.endString=te(i);else throw Error("Invalid cue timestamp format: must be a valid time string or a number of seconds");return this._cues.push(a),a}getCue(e){if(typeof e=="string")e=Re(e);else if(typeof e!="number")throw Error("Invalid time instant format getting cue");let t=null;return this._cues.some(i=>{if(e>=i.start&&e<=i.end)return t=i,!0}),t}}function tt(n,e){const t={},s=new DOMParser().parseFromString(e,"text/xml");return Array.from(s.getElementsByTagName("div")).forEach(a=>{const r=a.getAttribute("xml:lang")||"unknonw";t[r]=t[r]||new et(n.translate(r),r),Array.from(a.getElementsByTagName("p")).forEach(o=>{const l=We(o.getAttribute("begin"));t[r].addCue({label:`caption_${o.getAttribute("xml:id")||l}`,start:l/1e3,end:We(o.getAttribute("end"))/1e3,captions:o.innerHTML})})}),t}class oi{constructor(e,t=""){this.player=e,this._text=t,this._captions=tt(this.player,t)}get text(){return this._text}set text(e){this._text=e,this._captions=tt(e)}get captions(){return this._captions}}let it=null;class ae extends Ce{static Get(){return it||(it=new ae),it}get moduleName(){return"paella-core default plugins"}get moduleVersion(){return be.version}}class li extends Xe{getPluginModuleInstance(){return ae.Get()}get name(){return super.name||"es.upv.paella.dfxpManifestCaptionsPlugin"}async isEnabled(){return await super.isEnabled()&&this.player.videoManifest.captions&&this.player.videoManifest.captions.length>0}async getCaptions(){const e=[],t=[];return this.player.videoManifest.captions.forEach(i=>{t.push(new Promise(async(s,a)=>{if(/dfxp/i.test(i.format)){const r=H(this.player,i.url),o=await fetch(r);if(o.ok){let l=await o.text();l=l.replace(/[^\x09\x0A\x0D\x20-\xFF\x85\xA0-\uD7FF\uE000-\uFDCF\uFDE0-\uFFFD]/gm,""),l=l.replace(/&\w+;/gmi,""),l=l.replaceAll("<br>","");const d=new oi(this.player,l);Object.entries(d.captions).forEach(([y,g])=>{e.push(g)}),s()}else a()}else a()}))}),await Promise.allSettled(t),e}}class Ne extends se{constructor(e,t,i){super(e,t,i),this.__uiPlugin=!0}async getDictionaries(){return null}}let nt="en",ci="";const de={};function st(n){const e=de[nt]||{},t=de[ci]||{};return e[n]||t[n]||n}function at(n){nt=n}function rt(){return nt}function ot(n,e){de[n]=de[n]||{};for(const t in e){const i=e[t];de[n][t]=i}}function lt(){return de}function ct(n){return n.config.defaultLanguage||navigator.language}let ui=st,di=at,hi=rt,pi=ot,gi=lt,mi=ct;function he(n,e=null){const t=ui(n);if(Array.isArray(e)){let i=t;return e.forEach((s,a)=>{const r=`$${a+1}`;i=i.replace(r,s)}),i}else return t}function ut(n){di(n)}function fi(){return hi()}function pe(n,e){pi(n,e)}function yi(){return gi()}function dt(n){return mi(n)}function Cn(n){ui=n}function bn(n){di=n}function Ln(n){hi=n}function Pn(n){pi=n}function En(n){gi=n}function Sn(n){mi=n}function Tn(n){ci=dt(n)}async function Fe(n,e){var d,y;const t=b("<li></li>",e);t.plugin=n;const i=he(n.ariaLabel),s=he(n.description),a=n.dynamicWidth?"dynamic-width":"fixed-width",r=n.id?`id="${n.id}" `:"",o=n.buttonName?`name="${n.buttonName}" `:"",l=n.tabIndex?` tabindex="${n.tabIndex}" `:"";if(n.interactive){const g=b(`
			<button type="button" ${r}${o}class="${a}"${l}aria-label="${i}" title="${s}">
			</button>
		`,t);n.className!==""&&g.classList.add(n.className),n._button=g,n._container=t,g._pluginData=n,t._pluginData=n,g.addEventListener("click",u=>{const v=g._pluginData;E(v.player,p.BUTTON_PRESS,{plugin:v}),v.action(u,null),u.stopPropagation(),u.pageX!==0&&u.pageY!==0&&document.activeElement.blur()});let m=null;const _=()=>{m&&(clearTimeout(m),m=null)},L=()=>{_(),m=setTimeout(()=>{n.leftSideContainerPresent&&n.leftSideContainer.classList.add("hidden"),n.rightSideContainerPresent&&n.rightSideContainer.classList.add("hidden"),m=null},300)},P=()=>{_(),n.leftSideContainerPresent&&n.leftSideContainer.classList.remove("hidden"),n.rightSideContainerPresent&&n.rightSideContainer.classList.remove("hidden")};g.addEventListener("focus",P),g.addEventListener("mouseover",P),g.addEventListener("mouseout",L),g.addEventListener("blur",L),(((d=n.player.config.accessibility)==null?void 0:d.clickWithSpacebar)!==void 0?(y=n.player.config.accessibility)==null?void 0:y.clickWithSpacebar:!0)||(g.addEventListener("keyup",u=>{u.keyCode==32&&u.preventDefault()}),g.addEventListener("keydown",u=>{u.keyCode==32&&u.preventDefault()})),n.className!==""&&g.classList.add(n.className)}else{const g=b(`
			<div ${r}${o} class="non-interactive ${a}" title="${s}">
			</div>
		`,t);n._button=g,n._container=t,g._pluginData=n,t._pluginData=n,n.className!==""&&g.classList.add(n.className)}}const vi=()=>{const n=document.createElement("span");return n.classList.add("side-container"),n.classList.add("hidden"),n};class In{onIconChanged(e,t,i){}onTitleChanged(e,t,i){}onStateChanged(e,t,i,s,a){}}class Oe extends Ne{constructor(){super(...arguments);A(this,Q,null);A(this,Y,null);A(this,Ie,[])}get type(){return"button"}get container(){return this._container}get button(){return this._button}get interactive(){return!0}get dynamicWidth(){return!1}getId(){return null}get id(){return this.config.id||this.getId()}getButtonName(){return null}get buttonName(){return this.config.name||this.getButtonName()||this.name}get ariaLabel(){return this.config.ariaLabel||this.getAriaLabel()}getAriaLabel(){return""}get tabIndex(){return this.config.tabIndex||this.getTabIndex()}getTabIndex(){return null}getDescription(){return""}get description(){return this.config.description||this.getDescription()}get minContainerSize(){return this.config.minContainerSize||this.getMinContainerSize()}getMinContainerSize(){return 0}setObserver(t){if(t instanceof In)this._observer=t;else if(typeof t.onIconChanged=="function"||typeof t.onTitleChanged=="function"||typeof t.onStateChanged=="function")this._observer=t;else throw new Error("Invalid observer for ButtonPlugin")}get icon(){return this._icon||(this._icon=""),this._icon}set icon(t){var i;if(typeof t=="string"&&(t=zt(t)),this._icon=t,t&&this._button instanceof HTMLElement){const s=this._button.querySelector("i")||b("<i></i>",this._button);s.innerHTML=t}else if(this._button instanceof HTMLElement){const s=this._button.querySelector("i");s&&this._button.removeChild(s)}(i=this._observer)!=null&&i.onIconChanged&&this._observer.onIconChanged(this,this._icon,t)}get title(){return this._title||""}set title(t){var i;if(this._title=t,t&&this._button instanceof HTMLElement){const s=this._button.querySelector("span")||b(`<span class="button-title-${this.titleSize}"></span>`,this._button);s.innerHTML=t}else if(this._button instanceof HTMLElement){const s=this._button.querySelector("span");s&&this._button.removeChild(s)}(i=this._observer)!=null&&i.onTitleChanged&&this._observer.onTitleChanged(this,this._title,t)}get titleSize(){return"medium"}get side(){var i;return((i=this.config)==null?void 0:i.side)||"left"}get closePopUps(){return this.config.closePopUps||this.getClosePopUps()}getClosePopUps(){return!0}get parentContainer(){var i;return((i=this.config)==null?void 0:i.parentContainer)||"playbackBar"}get className(){return""}enable(){this._enabled=!0,this.show()}disable(){this._enabled=!1,this.hide()}hide(){this._button&&(this._button.style.display="none")}show(){if(this._enabled===!1)return;const{width:t}=this.player.playbackBar.containerSize;this._button&&(t>this.minContainerSize||this.parentContainer!=="playbackBar")&&(this._button.style.display=null)}get leftSideContainer(){return h(this,Q)||(M(this,Q,vi()),this.container.appendChild(h(this,Q))),h(this,Q)}get leftSideContainerPresent(){return h(this,Q)!==null}get rightSideContainer(){return h(this,Y)||(M(this,Y,vi()),this.container.appendChild(h(this,Y))),h(this,Y)}get rightSideContainerPresent(){return h(this,Y)!==null}get stateText(){return null}get stateIcon(){return null}setState({text:t=null,icon:i=null}={}){var r,o;const s=this._statusText,a=this._statusIcon;this._statusText=t,this._statusIcon=i,h(this,Ie).forEach(l=>l(this)),this._statusIcon&&(this.icon=this._statusIcon),this._statusText&&(this.title=this._statusText),(o=(r=this._observer)==null?void 0:r.onStateChanged)==null||o.call(r,this,s,t,a,i)}onStateChange(t){typeof t=="function"?h(this,Ie).push(t):this.player.log.warn("Invalid callback for ButtonPlugin.onStateChange")}async action(t,i=null){}onResize({width:t,height:i}){t<this.minContainerSize?this.hide():this.show()}focus(){var t;(t=this.button)==null||t.focus()}blur(){var t;(t=this.button)==null||t.blur()}isFocus(){return this.button===document.activeElement}}Q=new WeakMap,Y=new WeakMap,Ie=new WeakMap;const Dn=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="100%" height="100%" viewBox="0 0 23 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421;">
    <g id="play" transform="matrix(1.36051e-16,0.480277,-0.550439,1.55927e-16,74.9184,-144.269)">
        <path d="M325.373,94.327L350.358,136.107L300.387,136.107L325.373,94.327Z"/>
    </g>
</svg>
`,kn=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="100%" height="100%" viewBox="0 0 24 22" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421;">
    <g id="pause" transform="matrix(1,0,0,0.956522,-48,-7.65217)">
        <path d="M64,8L72,8L72,31L64,31L64,8ZM48,8L56,8L56,31L48,31L48,8Z"/>
    </g>
</svg>
`,An=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="100%" height="100%" viewBox="0 0 40 42" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
    <g transform="matrix(1.94013e-16,0.689169,-0.784942,2.23746e-16,110.436,-203.562)">
        <g id="play">
            <path d="M304.588,115.214C304.588,105.205 313.901,97.079 325.373,97.079C336.844,97.079 346.157,105.205 346.157,115.214C346.157,125.223 336.844,133.349 325.373,133.349L325.373,128.287C333.642,128.287 340.356,122.43 340.356,115.214C340.356,107.999 333.642,102.141 325.373,102.141C317.103,102.141 310.39,107.999 310.39,115.214L304.588,115.214Z"/>
            <g transform="matrix(-2.33361,-6.00363e-16,1.21708e-15,-2.59724,320.246,134.358)">
                <path d="M5.454,3.35L9.398,7.505L1.511,7.505L5.454,3.35Z"/>
            </g>
        </g>
    </g>
</svg>
`;class _i extends Oe{getPluginModuleInstance(){return ae.Get()}get name(){return super.name||"es.upv.paella.playPauseButton"}async load(){const e=this.player.getCustomPluginIcon(this.name,"play")||Dn,t=this.player.getCustomPluginIcon(this.name,"pause")||kn,i=this.player.getCustomPluginIcon(this.name,"replay")||An;this.icon=e,this.player.translate(this.config.ariaLabelPause||"pause");const s=this.player.translate(this.config.ariaLabelPlay||"play");T(this.player,p.PLAY,()=>{this.icon=t,this.button.ariaLabel=s,this.button.title=this.config.ariaLabelPause||s}),T(this.player,p.PAUSE,()=>{this.icon=e,this.button.ariaLabel=s,this.button.title=this.config.ariaLabelPause||s}),T(this.player,p.ENDED,()=>{this.icon=i,this.button.ariaLabel=s,this.button.title=this.config.ariaLabelPause||s}),T(this.player,p.STOP,()=>{this.icon=e,this.button.ariaLabel=s,this.button.title=this.config.ariaLabelPause||s})}async action(){await this.player.paused()?await this.player.videoContainer.play():await this.player.videoContainer.pause()}}const wi="(?:\\d*:){1,2}\\d*(?:\\.\\d+)?",Mn=`(${wi})\\s*\\-\\->\\s*(${wi})`,Rn={cueTiming:new RegExp(Mn)},xn=(n,e,t,i)=>{const s=Rn.cueTiming.exec(e);if(s){const a=i[t-1],r=[];for(let o=1;t+o<i.length&&i[t+o]!=="";++o)r.push(i[t+o]);n.addCue({label:a,start:s[1],end:s[2],captions:r})}};function ht(n){const e=new et;return n!==""&&(n=n.replace(/\r\n/gm,`
`),n=n.replace(/\r/gm,`
`),n.split(/\n/).forEach((t,i,s)=>{xn(e,t,i,s)})),e}class Ci{constructor(e=""){this._text=e,this._captions=ht(e)}get text(){return this._text}set text(e){this._text=e,this._captions=ht(e)}get captions(){return this._captions}}class bi extends Xe{getPluginModuleInstance(){return ae.Get()}get name(){return super.name||"es.upv.paella.vttManifestCaptionsPlugin"}async isEnabled(){return await super.isEnabled()&&this.player.videoManifest.captions&&this.player.videoManifest.captions.length>0}async getCaptions(){const e=[],t=[];return this.player.videoManifest.captions.forEach(i=>{t.push(new Promise(async(s,a)=>{if(/vtt/i.test(i.format)){const r=H(this.player,i.url),o=await fetch(r);if(o.ok){const l=await o.text(),d=new Ci(l);d.captions.label=i.text,d.captions.language=i.lang,e.push(d.captions),s()}else a()}else a()}))}),await Promise.allSettled(t),e}}class Li extends Oe{getPluginModuleInstance(){return ae.Get()}get name(){return"es.upv.paella.currentTimeLabel"}async load(){this.title=te(0);const e=async()=>{const t=await this.player.videoContainer.currentTime();let i=te(t);if(this.config.showTotalTime){const s=await this.player.videoContainer.duration();i+=` / ${te(s)}`}this.title=i};this.player.bindEvent(p.TIMEUPDATE,()=>e()),this.player.bindEvent(p.TRIMMING_CHANGED,()=>e()),this.player.bindEvent(p.SEEK,()=>e())}get interactive(){return!1}get dynamicWidth(){return!0}}function $e(n,e){return Tt(n,"layout").filter(i=>i.config&&i.config.enabled&&i.canApply(e))}function Pi(n,e){const t=$e(n,e),i=[];return t.forEach(s=>{i.push(...s.getValidContentIds(e))}),i}function Vn(n,e){const t=[];return Tt(n,"layout").filter(i=>{var s,a;if((s=i.config)!=null&&s.enabled&&((a=i.config)!=null&&a.validContent))return i.config.validContent.every(r=>r.content.length===e)}).forEach(i=>i.config.validContent.forEach(s=>t.push(s.content))),t}function Ei(n,e,t){const i=$e(n,e);let s=null;return i.some(a=>{if(a.getValidContentIds(e).indexOf(t)!==-1)return s=a,!0}),s}function Un(n,e){const t=$e(n,e),i=Pi(n,e);let s=[];return t.forEach(a=>{s=[...s,...a.config.validContent]}),s.filter(a=>i.indexOf(a.id)!==-1)}function Si(n,e,t,i=null){const s=Ei(n,e,t);if(s){const a=s.getLayoutStructure(e,t,i);return a.plugin=s,a}return null}class re extends Ne{get type(){return"layout"}get layoutType(){return"static"}getTabIndexStart(){return 10}get tabIndexStart(){var e;return((e=this.config)==null?void 0:e.tabIndexStart)||this.getTabIndexStart()}get identifier(){return"default"}get icon(){return"icon.png"}get validContent(){var e;return((e=this.config)==null?void 0:e.validContent)||[]}get validContentIds(){const e=[];return this.validContent.forEach(t=>e.push(t.id)),e}getValidContentIds(e){const t=[];return this.validContent.forEach(i=>{i.content.every(s=>e.some(a=>s===a.content))&&t.push(i.id)}),t}getValidStreams(e){const t=[];return this.validContent.forEach(i=>{let s=[];i.content.every(a=>e.some(r=>{if(a===r.content)return s.push(r),!0}))&&t.push(s)}),t}canApply(e){return this.getValidStreams(e).length>0}getLayoutStructure(){return{}}getVideoCanvasButtons(e,t,i){return[]}}function Nn(n){return{icon:n.icon,position:n.position,title:n.description,ariaLabel:n.ariaLabel,name:n.buttonName,click:async e=>{const t=n.player.videoContainer.streamProvider.streams[e];await n.action(e,t==null?void 0:t.player,t==null?void 0:t.canvas,t==null?void 0:t.canvasPlugin)}}}async function Fn(n,e){const t=[];return await V(n,"canvasButton",async i=>{n.log.debug(` Canvas button plugin: ${i.name}`),t.push(i)}),t.filter(i=>i.content.indexOf(e.content)!==-1).map(i=>Nn(i))}class On extends Ne{get type(){return"canvasButton"}get content(){return this._config.content||["presenter"]}get ariaLabel(){return this._config.ariaLabel||this.getAriaLabel()}getAriaLabel(){return""}get tabIndex(){return this.config.tabIndex}get description(){return this.config.description||this.getDescription()}getDescription(){return""}get icon(){return this._icon}set icon(e){this._icon=e}get side(){var e;return((e=this.config)==null?void 0:e.side)||"left"}get buttonName(){return this.name}get position(){switch(this.side){case"left":return I.LEFT;case"center":return I.CENTER;case"right":return I.RIGHT;default:throw new Error(`Invalid CanvasButtonPlugin side set: ${this.side}`)}}async action(e){this.player.log.warn(`Action not implemented in canvas button plugin ${this.name}`)}}const pt=[];async function $n(n){await V(n,"canvas",e=>{pt.push(e)})}async function Bn(n){}function Gn(n,e){if(pt.length===0)throw Error("No canvas plugins loaded. Note that `loadCanvasPlugins()` must to be called before use `getCanvasPlugins()`");let t=null;return pt.some(i=>{if(i.isCompatible(e))return t=i,!0}),t}const I=Object.freeze({LEFT:"left",CENTER:"center",RIGHT:"right"}),zn=function({icon:n,tabIndex:e,ariaLabel:t,title:i,className:s,position:a=I.CENTER,click:r,content:o,name:l}){if(!n)throw new Error("Error in video layout definition. getVideoCanvasButtons(): missing 'icon' attribute.");if(!r)throw new Error("Error in video layout definition. getVideoCanvasButtons(): missing 'click' function.");let d=`class="align-${a}${s?" "+s:""}"`;t&&(d+=` aria-label="${t}"`),i&&(d+=` title="${i}"`),e!==void 0&&(d+=` tabindex="${e}"`),l!==void 0&&(d+=` name="${l}"`);const y=b(`
        <button ${d}><i class="button-icon" style="pointer-events: none">${n}</i></button>
    `);return this.buttonsArea.appendChild(y),y.addEventListener("click",async g=>(g.stopPropagation(),await r(o),!1)),y},gt=async(n,e,t,i,s)=>{const a=e.plugin;let r=a.tabIndexStart;const o=await Fn(n,i),l=[];return[...o,...a.getVideoCanvasButtons(e,i.content,i,t)].forEach(y=>{y.tabIndex=r++,y.content=s;const g=zn.apply(t,[y]);l.push(g)}),l},mt=(n,e,t)=>{let{tabIndexStart:i}=e.plugin;t.sort((s,a)=>{const r=s.getBoundingClientRect().left,o=a.getBoundingClientRect().left;return r-o}).forEach(s=>{s.setAttribute("tabindex",i++)})};class ft extends O{constructor(e,t,i){super(t,{tag:e,parent:i}),this.element.className="video-canvas",this._userArea=null,this._buttonsArea=b(`
        <div class="button-area">
        </div>
        `,this.element)}async loadCanvas(e){throw Error(`${this.name}: loadCanvas() not implemented`)}get userArea(){return this._userArea||(this._userArea=document.createElement("div"),this._userArea.className="user-area",this.element.appendChild(this._userArea)),this._userArea}get buttonsArea(){return this._buttonsArea}showButtons(){this.buttonsArea.style.display=null}hideButtons(){this.buttonsArea.style.display="none"}}class yt extends se{get type(){return"canvas"}get canvasType(){return""}isCompatible(e){return Array.isArray(e==null?void 0:e.canvas)?e.canvas.indexOf(this.canvasType)!==-1:e.canvas===this.canvasType}getCanvasInstance(e){throw Error(`${this.name} canvas plugin: getCanvasInstance() not implemented`)}}let vt=null;class W extends Ce{static Get(){return vt||(vt=new W),vt}get moduleName(){return"paella-core default video layouts"}get moduleVersion(){return be.version}}const _t=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="100%" height="100%" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
    <g transform="matrix(0.920758,0,0,0.920758,2.50561,1.21236)">
        <path d="M11.937,17.699L11.937,21.044C11.937,21.656 11.573,22.209 11.012,22.451C10.45,22.693 9.798,22.578 9.354,22.158L1.874,15.1C1.568,14.811 1.394,14.408 1.394,13.986C1.394,13.564 1.568,13.161 1.874,12.872L9.354,5.814C9.798,5.394 10.45,5.279 11.012,5.521C11.573,5.763 11.937,6.316 11.937,6.928L11.937,10.272L22.937,10.272C23.783,10.272 24.469,10.958 24.469,11.804L24.469,16.168C24.469,17.014 23.783,17.699 22.937,17.699L11.937,17.699ZM26.063,23.11L26.063,19.765C26.063,19.153 26.427,18.6 26.988,18.358C27.55,18.116 28.201,18.231 28.646,18.651L36.126,25.709C36.432,25.999 36.606,26.402 36.606,26.823C36.606,27.245 36.432,27.648 36.126,27.937L28.646,34.996C28.201,35.415 27.55,35.53 26.988,35.288C26.427,35.046 26.063,34.493 26.063,33.882L26.063,30.537L15.063,30.537C14.217,30.537 13.531,29.851 13.531,29.005L13.531,24.641C13.531,23.795 14.217,23.11 15.063,23.11L26.063,23.11Z"/>
    </g>
</svg>
`,Be=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="100%" height="100%" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
    <g transform="matrix(-0.620305,0,0,0.839332,25.2077,0.462208)">
        <path d="M-20.625,8.591C-20.625,6.174 -17.975,4.215 -14.704,4.215L31.492,4.215C34.763,4.215 37.413,6.174 37.413,8.591L37.413,35.582C37.413,37.998 34.763,39.957 31.492,39.957L-14.704,39.957C-17.975,39.957 -20.625,37.998 -20.625,35.582L-20.625,8.591ZM1.285,12.825L8.1,7.789L-15.786,7.789L-15.786,25.442L-8.972,20.406L6.737,32.016L16.994,24.435L1.285,12.825Z" />
    </g>
</svg>
`,Le=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="100%" height="100%" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
    <g transform="matrix(0.707107,0.707107,-0.707107,0.707107,20,-8.28427)">
        <path d="M23,17L23,4.998C23,4.203 22.684,3.44 22.122,2.878C21.56,2.316 20.797,2 20.002,2C20.001,2 19.999,2 19.998,2C19.203,2 18.44,2.316 17.878,2.878C17.316,3.44 17,4.203 17,4.998C17,9.375 17,17 17,17L4.998,17C4.203,17 3.44,17.316 2.878,17.878C2.316,18.44 2,19.203 2,19.998C2,19.999 2,20.001 2,20.002C2,20.797 2.316,21.56 2.878,22.122C3.44,22.684 4.203,23 4.998,23C9.375,23 17,23 17,23L17,35.002C17,35.797 17.316,36.56 17.878,37.122C18.44,37.684 19.203,38 19.998,38C19.999,38 20.001,38 20.002,38C20.797,38 21.56,37.684 22.122,37.122C22.684,36.56 23,35.797 23,35.002C23,30.625 23,23 23,23L35.002,23C35.797,23 36.56,22.684 37.122,22.122C37.684,21.56 38,20.797 38,20.002C38,20.001 38,19.999 38,19.998C38,19.203 37.684,18.44 37.122,17.878C36.56,17.316 35.797,17 35.002,17C30.625,17 23,17 23,17Z"/>
    </g>
</svg>`,Pe=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="100%" height="100%" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
    <g>
        <path d="M18,13.029L18,26.971C18,27.509 17.786,28.025 17.406,28.406C17.025,28.786 16.509,29 15.971,29L3.029,29C2.491,29 1.975,28.786 1.594,28.406C1.214,28.025 1,27.509 1,26.971L1,13.029C1,12.491 1.214,11.975 1.594,11.594C1.975,11.214 2.491,11 3.029,11L15.971,11C16.509,11 17.025,11.214 17.406,11.594C17.786,11.975 18,12.491 18,13.029ZM39,13.029L39,26.971C39,27.509 38.786,28.025 38.406,28.406C38.025,28.786 37.509,29 36.971,29L24.029,29C23.491,29 22.975,28.786 22.594,28.406C22.214,28.025 22,27.509 22,26.971L22,13.029C22,12.491 22.214,11.975 22.594,11.594C22.975,11.214 23.491,11 24.029,11L36.971,11C37.509,11 38.025,11.214 38.406,11.594C38.786,11.975 39,12.491 39,13.029ZM21,7L21,33L19,33L19,7L21,7Z"/>
    </g>
</svg>
`,Hn=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="100%" height="100%" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
    <g transform="matrix(-0.620305,0,0,0.839332,25.2077,0.462208)">
        <g transform="matrix(-1.61211,0,0,1.19142,40.6376,-0.550686)">
            <path d="M38.001,14.89L16.256,14.89C15.767,14.89 15.297,15.084 14.951,15.43C14.605,15.776 14.41,16.246 14.41,16.735C14.41,21.528 14.41,33.999 14.41,33.999L5.673,33.999C3.644,33.999 2,32.355 2,30.327L2,7.673C2,5.644 3.644,4 5.673,4L34.329,4C36.358,4 38.001,5.644 38.001,7.673L38.001,14.89Z"/>
        </g>
        <g transform="matrix(-1.62701,0,0,1.19712,41.1319,-0.602464)">
            <path d="M39.174,17.858C39.174,17.501 39.032,17.158 38.781,16.906C38.529,16.653 38.188,16.511 37.833,16.511C33.587,16.511 20.516,16.511 17.043,16.511C16.816,16.511 16.598,16.602 16.438,16.763C16.278,16.924 16.188,17.142 16.188,17.37C16.188,20.366 16.188,30.369 16.188,34.019C16.188,34.376 16.329,34.719 16.581,34.971C16.832,35.224 17.173,35.366 17.529,35.366C21.597,35.366 33.765,35.366 37.833,35.366C38.188,35.366 38.529,35.224 38.781,34.971C39.032,34.719 39.174,34.376 39.174,34.019C39.174,30.548 39.174,21.329 39.174,17.858Z"/>
        </g>
    </g>
</svg>
`;class wt extends re{getPluginModuleInstance(){return W.Get()}get name(){return super.name||"es.upv.paella.dualVideoDynamic"}get layoutType(){return"dynamic"}async load(){this.pipContentIds=this.config.pipContentIds||[],this.allowSwitchSide=this.config.allowSwitchSide!==void 0?this.config.allowSwitchSide:!0}getVideoCanvasButtons(e,t,i,s){const a=this.player.getCustomPluginIcon(this.name,"iconMaximize")||Be,r=this.player.getCustomPluginIcon(this.name,"iconSideBySide")||Pe,o=this.player.getCustomPluginIcon(this.name,"iconSwitchSide")||_t,l=this.player.getCustomPluginIcon(this.name,"iconClose")||Le,d=this.player.getCustomPluginIcon(this.name,"iconPiP")||Hn,y=()=>this._currentContent.find(L=>L.id===t),g=()=>y().size===25,m=()=>y().size>50,_=[];return g()||m()?_.push({icon:r,position:I.LEFT,title:this.player.translate("Dual stream 50%"),ariaLabel:this.player.translate("Dual stream 50%"),name:this.name+":iconSideBySide",click:async()=>{this._currentContent.forEach(L=>{L.size=50}),await this.player.videoContainer.updateLayout()}}):_.push({icon:a,position:I.LEFT,title:this.player.translate("Maximize video"),ariaLabel:this.player.translate("Maximize video"),name:this.name+":iconMaximize",click:async()=>{this._currentContent.forEach(L=>{L.size=L.id===t?75:25}),await this.player.videoContainer.updateLayout()}}),this.allowSwitchSide&&_.push({icon:o,position:I.LEFT,title:this.player.translate("Switch side"),ariaLabel:this.player.translate("Switch side"),name:this.name+":iconSwitchSide",click:async()=>{const L=this._currentContent[0].id,P=this._currentContent[1].id,C=this._currentContent[0].size,u=this._currentContent[1].size;this._currentContent[0].id=P,this._currentContent[0].size=u,this._currentContent[1].id=L,this._currentContent[1].size=C,await this.player.videoContainer.updateLayout()}}),_.push({icon:l,position:I.RIGHT,title:this.player.translate("Close video"),ariaLabel:this.player.translate("Close video"),name:this.name+":iconClose",click:async()=>{const P=this.player.videoContainer.validContentIds.filter(C=>C.indexOf("-")===-1).find(C=>C!=t);await this.player.videoContainer.setLayout(P)}}),this.pipContentIds.length>0&&_.push({icon:d,position:I.LEFT,title:this.player.translate("Picture-in-picture"),ariaLabel:this.player.translate("Picture-in-picture"),name:this.name+":iconPiP",click:async()=>{const L=this.player.videoContainer.validContentIds.find(P=>this.pipContentIds.indexOf(P)!==-1);await this.player.videoContainer.setLayout(L,t)}}),_}getLayoutStructure(e,t,i){if(!this._currentContent){const{content:s}=this.validContent.find(a=>a.id===t);this._currentContent=s.map(a=>({id:a,size:50}))}return{id:"dual-dynamic",videos:[{content:this._currentContent[0].id,visible:!0,size:this._currentContent[0].size},{content:this._currentContent[1].id,visible:!0,size:this._currentContent[1].size}]}}}const Ti=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="100%" height="100%" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
    <g transform="matrix(-0.620305,0,0,0.839332,25.2077,0.462208)">
        <g transform="matrix(-1.50139,0,0,1.10483,39.8625,1.72153)">
            <path d="M22.034,28.802C22.58,28.752 23.089,28.64 23.626,28.496C28.793,27.112 31.864,21.792 30.48,16.625C30.189,15.54 29.715,14.525 29.088,13.619L31.915,8.722C33.663,10.535 34.942,12.776 35.606,15.251C37.748,23.248 32.996,31.48 24.999,33.622C24.011,33.887 23.04,34.063 22.034,34.123L22.034,40.015L13,31.5L22.034,23.015L22.034,28.802Z" />
        </g>
        <g transform="matrix(1.50139,1.35303e-16,1.83867e-16,-1.10483,-24.8768,44.5033)">
            <path d="M22.161,28.786C22.706,28.736 23.089,28.64 23.626,28.496C28.793,27.112 31.864,21.792 30.48,16.625C30.189,15.54 29.715,14.525 29.088,13.619L31.915,8.722C33.663,10.535 34.942,12.776 35.606,15.251C37.748,23.248 32.996,31.48 24.999,33.622C24.011,33.887 23.167,34.048 22.161,34.107L22.161,40L13,31.5L22.161,23L22.161,28.786Z" />
        </g>
    </g>
</svg>
`,jn=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="100%" height="100%" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
    <g transform="matrix(-0.620305,0,0,0.839332,25.2077,0.462208)">
        <g transform="matrix(-1.61211,0,0,1.25099,40.6376,0.938594)">
            <path d="M26,18.498C26,16.566 24.356,15 22.327,15C17.811,15 10.189,15 5.673,15C3.644,15 2,16.566 2,18.498C2,22.151 2,27.849 2,31.502C2,33.434 3.644,35 5.673,35C10.189,35 17.811,35 22.327,35C24.356,35 26,33.434 26,31.502C26,27.849 26,22.151 26,18.498Z" />
        </g>
        <path d="M-2.889,42.341L-16.002,42.341C-17.664,42.341 -19.01,41.345 -19.01,40.117L-19.01,11.346L-15.787,13.728L-15.787,36.879C-15.787,37.695 -15.348,38.478 -14.567,39.056C-13.785,39.633 -12.726,39.958 -11.621,39.958L-2.889,39.958L-2.889,42.341ZM30.962,18.512L30.962,8.485C30.962,7.669 30.523,6.886 29.741,6.308C28.96,5.731 27.9,5.406 26.795,5.406L-4.721,5.406L-7.945,3.024L31.181,3.024C32.842,3.024 34.189,4.019 34.189,5.247L34.189,18.512L30.962,18.512Z" />
        <g transform="matrix(-0.595969,-0.440448,-1.13993,0.842464,17.4661,11.4472)">
            <path d="M18.389,14.006L18.389,18L5,11L18.389,4L18.389,7.994L36,7.994L36,14.006L18.389,14.006Z" />
        </g>
    </g>
</svg>
`;let $=0;const Ct=[{id:"side-by-side",videos:[{content:null,rect:[{aspectRatio:"16/9",width:560,height:315,top:218,left:712},{aspectRatio:"16/10",width:560,height:350,top:206,left:712},{aspectRatio:"4/3",width:560,height:420,top:173,left:712},{aspectRatio:"5/3",width:560,height:336,top:206,left:712},{aspectRatio:"5/4",width:560,height:448,top:160,left:712}],visible:!0,layer:1},{content:null,rect:[{aspectRatio:"16/9",width:688,height:387,top:166,left:10},{aspectRatio:"16/10",width:688,height:430,top:148,left:10},{aspectRatio:"4/3",width:688,height:516,top:111,left:10},{aspectRatio:"5/3",width:690,height:414,top:154,left:10},{aspectRatio:"5/4",width:690,height:552,top:96,left:10}],visible:!0,layer:"1"}],buttons:[]},{id:"pip-left",videos:[{content:null,rect:[{aspectRatio:"16/9",left:0,top:0,width:1280,height:720},{aspectRatio:"16/10",left:64,top:0,width:1152,height:720},{aspectRatio:"5/3",left:40,top:0,width:1200,height:720},{aspectRatio:"5/4",left:190,top:0,width:900,height:720},{aspectRatio:"4/3",left:160,top:0,width:960,height:720}],visible:!0,layer:1},{content:null,rect:[{aspectRatio:"16/9",left:50,top:470,width:350,height:197},{aspectRatio:"16/10",left:50,top:448,width:350,height:219},{aspectRatio:"5/3",left:50,top:457,width:350,height:210},{aspectRatio:"5/4",left:50,top:387,width:350,height:280},{aspectRatio:"4/3",left:50,top:404,width:350,height:262}],visible:!0,layer:2}],buttons:[]},{id:"pip-right",videos:[{content:null,rect:[{aspectRatio:"16/9",left:0,top:0,width:1280,height:720},{aspectRatio:"16/10",left:64,top:0,width:1152,height:720},{aspectRatio:"5/3",left:40,top:0,width:1200,height:720},{aspectRatio:"5/4",left:190,top:0,width:900,height:720},{aspectRatio:"4/3",left:160,top:0,width:960,height:720}],visible:!0,layer:1},{content:null,rect:[{aspectRatio:"16/9",left:880,top:470,width:350,height:197},{aspectRatio:"16/10",left:880,top:448,width:350,height:219},{aspectRatio:"5/3",left:880,top:457,width:350,height:210},{aspectRatio:"5/4",left:880,top:387,width:350,height:280},{aspectRatio:"4/3",left:880,top:404,width:350,height:262}],visible:!0,layer:2}],buttons:[]}];function Wn(n){return $=($+1)%Ct.length,bt(n)}function Ee(n,e){return $=e<Ct.length?e:$,bt(n)}function bt(n){let e=JSON.parse(JSON.stringify(Ct[$]));return e.videos[0].content=n[0],e.videos[1].content=n[1],e}class Ii extends re{getPluginModuleInstance(){return W.Get()}get name(){return super.name||"es.upv.paella.dualVideo"}get identifier(){return"dual-video"}async load(){let e=j("dualVideoLayoutIndex");e!==""&&($=Number(e)),this.player.log.debug("Dual video layout loaded")}getValidStreams(e){return super.getValidStreams(e).filter(t=>t.length===2)}switchContent(){const e=this._currentContent[0],t=this._currentContent[1];this._currentContent[0]=t,this._currentContent[1]=e,this.player.videoContainer.updateLayout()}async switchMinimized(){Wn(this._currentContent),await this.player.videoContainer.updateLayout()}async minimizeVideo(e){let t=!0;if(e===this._currentContent[0]){const i=this._currentContent[0],s=this._currentContent[1];this._currentContent[0]=s,this._currentContent[1]=i,t=!1}$===1&&t?Ee(this._currentContent,2):Ee(this._currentContent,1),await this.player.videoContainer.updateLayout()}async maximizeVideo(e){let t=!0;if(e===this._currentContent[1]){const i=this._currentContent[0],s=this._currentContent[1];this._currentContent[0]=s,this._currentContent[1]=i,t=!1}$===1&&t?Ee(this._currentContent,2):Ee(this._currentContent,1),await this.player.videoContainer.updateLayout()}async setSideBySide(){Ee(this._currentContent,0),await this.player.videoContainer.updateLayout()}get minimizedContent(){return $===0?"":this._currentContent[1]}async closeVideo(e){const i=this.player.videoContainer.validContentIds.filter(s=>s.indexOf("-")===-1).find(s=>s!=e);await this.player.videoContainer.setLayout(i)}getVideoCanvasButtons(e,t,i,s){if(e.id==="side-by-side")return[{icon:this.player.getCustomPluginIcon(this.name,"iconRotate")||Ti,position:I.LEFT,title:this.player.translate("Swap position of the videos"),ariaLabel:this.player.translate("Swap position of the videos"),name:this.name+":iconRotate",click:async()=>{await this.switchContent()}},{icon:this.player.getCustomPluginIcon(this.name,"iconMaximize")||Be,position:I.LEFT,title:this.player.translate("Maximize video"),ariaLabel:this.player.translate("Maximize video"),name:this.name+":iconMaximize",click:async()=>{await this.maximizeVideo(t)}},{icon:this.player.getCustomPluginIcon(this.name,"iconClose")||Le,position:I.RIGHT,title:this.player.translate("Close video"),ariaLabel:this.player.translate("Close video"),name:this.name+":iconClose",click:async()=>{await this.closeVideo(t)}}];{const a=[];return t===this.minimizedContent?(a.push({icon:this.player.getCustomPluginIcon(this.name,"iconMaximize")||Be,position:I.LEFT,title:this.player.translate("Maximize video"),ariaLabel:this.player.translate("Maximize video"),name:this.name+":iconMaximize",click:async()=>{await this.switchContent()}}),a.push({icon:this.player.getCustomPluginIcon(this.name,"iconSwitchSide")||_t,position:I.LEFT,title:this.player.translate("Place the video on the other side of the screen"),ariaLabel:this.player.translate("Place the video on the other side of the screen"),name:this.name+":iconSwitchSide",click:async()=>{await this.minimizeVideo(t)}}),a.push({icon:this.player.getCustomPluginIcon(this.name,"iconClose")||Le,position:I.RIGHT,title:this.player.translate("Close video"),ariaLabel:this.player.translate("Close video"),name:this.name+":iconClose",click:async()=>{await this.closeVideo(t)}})):(a.push({icon:this.player.getCustomPluginIcon(this.name,"iconMinimize")||jn,position:I.LEFT,title:this.player.translate("Minimize video"),ariaLabel:this.player.translate("Minimize video"),name:this.name+":iconMinimize",click:async()=>{await this.switchContent()}}),a.push({icon:this.player.getCustomPluginIcon(this.name,"iconSideBySide")||Pe,position:I.LEFT,title:this.player.translate("Put the videos side by side"),ariaLabel:this.player.translate("Put the videos side by side"),name:this.name+":iconSideBySide",click:async()=>{await this.setSideBySide()}}),a.push({icon:this.player.getCustomPluginIcon(this.name,"iconClose")||Le,position:I.RIGHT,title:this.player.translate("Close video"),ariaLabel:this.player.translate("Close video"),name:this.name+":iconClose",click:async()=>{await this.closeVideo(t)}})),a}}getLayoutStructure(e,t){if(!this._currentContent||this._currentContentId!==t){const{content:a}=this.validContent.find(l=>l.id===t);this._currentContent=a,this._currentContentId=t;const r=j("dualVideoLayoutContent0"),o=j("dualVideoLayoutContent1");r!==""&&o!==""&&this._currentContent.indexOf(r)!==-1&&this._currentContent.indexOf(o)!==-1&&(this._currentContent[0]=r,this._currentContent[1]=o)}const i=bt(this._currentContent),s={id:i.id,player:this.player,name:{es:"Dos streams con posición dinámica"},hidden:!1,videos:i.videos,buttons:[]};return ie("dualVideoLayoutIndex",$),ie("dualVideoLayoutContent0",this._currentContent[0]),ie("dualVideoLayoutContent1",this._currentContent[1]),s}}const Di={id:"pip-left",name:{es:"Dos streams imagen dentro de imagen"},hidden:!1,videos:[{content:null,rect:[{aspectRatio:"16/9",left:0,top:0,width:1280,height:720},{aspectRatio:"16/10",left:64,top:0,width:1152,height:720},{aspectRatio:"5/3",left:40,top:0,width:1200,height:720},{aspectRatio:"5/4",left:190,top:0,width:900,height:720},{aspectRatio:"4/3",left:160,top:0,width:960,height:720},{aspectRatio:"9/16",left:617,top:17,width:386,height:687}],visible:!0,layer:1},{content:null,rect:[{aspectRatio:"16/9",left:50,top:470,width:350,height:197},{aspectRatio:"16/10",left:50,top:448,width:350,height:219},{aspectRatio:"5/3",left:50,top:457,width:350,height:210},{aspectRatio:"5/4",left:50,top:387,width:350,height:280},{aspectRatio:"4/3",left:50,top:404,width:350,height:262},{aspectRatio:"9/16",left:224,top:301,width:224,height:400}],visible:!0,layer:2}],buttons:[]},qn={id:"pip-right",name:{es:"Dos streams imagen dentro de imagen a la derecha"},hidden:!1,videos:[{content:null,rect:[{aspectRatio:"16/9",left:0,top:0,width:1280,height:720},{aspectRatio:"16/10",left:64,top:0,width:1152,height:720},{aspectRatio:"5/3",left:40,top:0,width:1200,height:720},{aspectRatio:"5/4",left:190,top:0,width:900,height:720},{aspectRatio:"4/3",left:160,top:0,width:960,height:720},{aspectRatio:"9/16",left:242,top:17,width:386,height:687}],visible:!0,layer:1},{content:null,rect:[{aspectRatio:"16/9",left:880,top:470,width:350,height:197},{aspectRatio:"16/10",left:880,top:448,width:350,height:219},{aspectRatio:"5/3",left:880,top:457,width:350,height:210},{aspectRatio:"5/4",left:880,top:387,width:350,height:280},{aspectRatio:"4/3",left:880,top:404,width:350,height:262},{aspectRatio:"9/16",left:887,top:304,width:224,height:400}],visible:!0,layer:2}],buttons:[]};class Qn extends re{getPluginModuleInstance(){return W.Get()}get name(){return super.name||"es.upv.paella.dualVideoPiP"}get identifier(){return"dual-video-pip"}async load(){this._currentLayout=Di,this.dualVideoContentIds=this.config.dualVideoContentIds||[]}getValidStreams(e){return super.getValidStreams(e).filter(t=>t.length===2)}getVideoCanvasButtons(e,t,i,s){const a=this.player.getCustomPluginIcon(this.name,"iconClose")||Le,r=this.player.getCustomPluginIcon(this.name,"iconSwitchSide")||_t,o=this.player.getCustomPluginIcon(this.name,"iconMaximize")||Be,l=this.player.getCustomPluginIcon(this.name,"iconSideBySide")||Pe,d=[{icon:a,position:I.RIGHT,title:this.player.translate("Close video"),ariaLabel:this.player.translate("Close video"),name:this.name+":iconClose",click:async()=>{const g=this.player.videoContainer.validContentIds.filter(m=>m.indexOf("-")===-1).find(m=>m!==t);await this.player.videoContainer.setLayout(g)}}];return t===this._pipVideo?(d.push({icon:r,position:I.LEFT,title:this.player.translate("Switch side"),ariaLabel:this.player.translate("Switch side"),name:this.name+":iconSwitchSide",click:async()=>{this.switchSide(),await this.player.videoContainer.updateLayout(this._fullVideo)}}),d.push({icon:o,position:I.LEFT,title:this.player.translate("Maximize video"),ariaLabel:this.player.translate("Maximize video"),name:this.name+":iconMaximize",click:async()=>{this.switchSources(),await this.player.videoContainer.updateLayout(this._fullVideo)}})):this.dualVideoContentIds.length>0&&d.push({icon:l,position:I.LEFT,title:this.player.translate("Set side by side"),ariaLabel:this.player.translate("Set side by side"),name:this.name+":iconSideBySide",click:async()=>{const y=this.player.videoContainer.validContentIds,g=this.dualVideoContentIds.find(m=>y.indexOf(m)!==-1);g&&this.player.videoContainer.setLayout(g)}}),d}switchSide(){this._currentLayout.id==="pip-left"?this._currentLayout=qn:this._currentLayout=Di}switchSources(){const e=this._pipVideo;this._pipVideo=this._fullVideo,this._fullVideo=e}getLayoutStructure(e,t,i){const{content:s}=this.validContent.find(r=>r.id===t);i&&s.find(r=>r===i)?(this._fullVideo=i,this._pipVideo=s.find(r=>r!==i)):(!this._pipVideo||!this._fullVideo)&&(this._pipVideo=s[0],this._fullVideo=s[1]);const a=JSON.parse(JSON.stringify(this._currentLayout));return a.player=this.player,a.videos[0].content=this._fullVideo,a.videos[1].content=this._pipVideo,a}}class ki extends re{getPluginModuleInstance(){return W.Get()}get name(){return super.name||"es.upv.paella.singleVideo"}get identifier(){return"single-video"}async load(){this.player.log.debug("Single video layout loaded"),this.dualVideoContentIds=this.config.dualVideoContentIds||["presenter-presentation-dynamic","presenter-2-presentation-dynamic","presenter-presenter-2-dynamic","presenter-presentation","presenter-2-presentation","presenter-presenter-2"]}getValidStreams(e){return super.getValidStreams(e).filter(t=>t.length===1)}getVideoCanvasButtons(e,t,i,s){return this._multiStream?[{icon:this.player.getCustomPluginIcon(this.name,"iconSideBySide")||Pe,position:I.LEFT,title:this.player.translate("Two videos 50%"),ariaLabel:this.player.translate("Two videos 50%"),name:this.name+":iconSideBySide",click:()=>{const a=this.player.videoContainer.validContentIds,r=this.dualVideoContentIds.find(o=>a.indexOf(o)!==-1);r&&this.player.videoContainer.setLayout(r)}}]:[]}getLayoutStructure(e,t){const i=this.validContent.find(a=>a.id===t),s={player:this.player,name:{es:"One stream"},hidden:!1,videos:[{content:i.content[0],rect:[{aspectRatio:"1/1",left:280,top:0,width:720,height:720},{aspectRatio:"6/5",left:208,top:0,width:864,height:720},{aspectRatio:"5/4",left:190,top:0,width:900,height:720},{aspectRatio:"4/3",left:160,top:0,width:960,height:720},{aspectRatio:"11/8",left:145,top:0,width:990,height:720},{aspectRatio:"1.41/1",left:132,top:0,width:1015,height:720},{aspectRatio:"1.43/1",left:125,top:0,width:1029,height:720},{aspectRatio:"3/2",left:100,top:0,width:1080,height:720},{aspectRatio:"16/10",left:64,top:0,width:1152,height:720},{aspectRatio:"5/3",left:40,top:0,width:1200,height:720},{aspectRatio:"16/9",left:0,top:0,width:1280,height:720},{aspectRatio:"1.85/1",left:0,top:14,width:1280,height:692},{aspectRatio:"2.35/1",left:0,top:87,width:1280,height:544},{aspectRatio:"2.41/1",left:0,top:94,width:1280,height:531},{aspectRatio:"2.76/1",left:0,top:128,width:1280,height:463}],visible:!0,layer:1}],background:{content:"slide_professor_paella.jpg",zIndex:5,rect:{left:0,top:0,width:1280,height:720},visible:!0,layer:0},logos:[{content:"paella_logo.png",zIndex:5,rect:{top:10,left:10,width:49,height:42}}],buttons:[],onApply:function(){}};return e.length>1&&(this._multiStream=!0),s}}class Yn extends re{getPluginModuleInstance(){return W.Get()}get name(){return super.name||"es.upv.paella.singleVideoDynamic"}get layoutType(){return"dynamic"}async load(){this.player.log.debug("Single video dynamic layout loaded"),this.dualVideoContentIds=this.config.dualVideoContentIds||["presenter-presentation-dynamic","presenter-2-presentation-dynamic","presenter-presenter-2-dynamic","presenter-presentation","presenter-2-presentation","presenter-presenter-2"]}getVideoCanvasButtons(e,t,i,s){const a=this.player.getCustomPluginIcon(this.name,"iconSideBySide")||Pe,r=[];return this._multiStream&&r.push({icon:a,position:I.LEFT,title:this.player.translate("Dual stream 50%"),ariaLabel:this.player.translate("Dual stream 50%"),name:this.name+":iconSideBySide",click:async()=>{const o=this.player.videoContainer.validContentIds,l=this.dualVideoContentIds.find(d=>o.indexOf(d)!==-1);l&&this.player.videoContainer.setLayout(l)}}),r}getLayoutStructure(e,t,i){e.length>1&&(this._multiStream=!0);const{content:s}=this.validContent.find(a=>a.id===t);return this._currentContent=s.map(a=>({id:a,size:50})),{id:"single-dynamic",videos:[{content:this._currentContent[0].id,visible:!0,size:this._currentContent[0].size}]}}}const Zn={videos:[{content:{},rect:[{aspectRatio:"16/9",left:239,top:17,width:803,height:451}],visible:!0,layer:1},{content:{},rect:[{aspectRatio:"16/9",left:44,top:482,width:389,height:218}],visible:!0,layer:1},{content:{},rect:[{aspectRatio:"16/9",left:847,top:482,width:389,height:218}],visible:!0,layer:1}],buttons:[{rect:{left:618,top:495,width:45,height:45},onClick:function(n){this.rotate()},label:"Rotate",icon:"icon_rotate.svg",layer:2}]};function Kn(n){let e=JSON.parse(JSON.stringify(Zn));return e.videos[0].content=n[0],e.videos[1].content=n[1],e.videos[2].content=n[2],e}class Ai extends re{getPluginModuleInstance(){return W.Get()}get name(){return super.name||"es.upv.paella.tripleVideo"}get identifier(){return"triple-video"}async load(){this.player.log.debug("Triple video layout loaded")}getValidStreams(e){return super.getValidStreams(e).filter(t=>t.length===3)}switchContent(){const e=this._currentContent[0],t=this._currentContent[1],i=this._currentContent[2];this._currentContent[0]=i,this._currentContent[1]=e,this._currentContent[2]=t,this.player.videoContainer.updateLayout()}getLayoutStructure(e,t){if(!this._currentContent||this._currentContentId!==t){this._currentContentId=t;const{content:a}=this.validContent.find(r=>r.id===t);this._currentContent=a}const i=Kn(this._currentContent);return{player:this.player,name:{es:"Three streams with dynamic position"},hidden:!1,videos:i.videos,buttons:[{rect:i.buttons[0].rect,onClick:()=>{this.switchContent()},label:"Switch",icon:Ti,layer:2,ariaLabel:"Swap the position of the videos",title:"Swap the position of the videos"}]}}}class Jn extends ft{constructor(e,t){super("div",e,t),this.element.classList.add("image-canvas")}async loadCanvas(e){e.element.style.width="100%",e.element.style.height="100%"}}class Xn extends yt{get name(){return super.name||"es.upv.paella.audioCanvas"}get canvasType(){return"audio"}getCanvasInstance(e){return new Jn(this.player,e)}}class Mi extends ft{constructor(e,t){super("div",e,t)}async loadCanvas(e){e.element.style.width="100%",e.element.style.height="100%"}}class Ri extends yt{get name(){return super.name||"es.upv.paella.videoCanvas"}get canvasType(){return"video"}async isCompatible(e){return!Array.isArray(e.canvas)||e.canvas.length===0?!0:await super.isCompatible(e)}getCanvasInstance(e){return new Mi(this.player,e)}}class Lt extends se{get type(){return"data"}get context(){return this.config.context||[]}async read(){throw Error(`DataPlugin.read() not implemented in data plugin '${this.name}'`)}async write(){throw Error(`DataPlugin.write() not implemented in data plugin '${this.name}'`)}async remove(){throw Error(`DataPlugin.remove() not implemented in data plugin '${this.name}'`)}}class xi extends ne{constructor(e){super(e),this._dataPlugins={},V(this.player,"data",async t=>{var i;(i=t.context)==null||i.forEach(s=>{this._dataPlugins[s]=this._dataPlugins[s]||[],this._dataPlugins[s].push(t)})})}getDataPlugin(e){let t=this._dataPlugins[e]&&this._dataPlugins[e].length>0&&this._dataPlugins[e][0];if(t||(t=this._dataPlugins.default&&this._dataPlugins.default.length>0&&this._dataPlugins.default[0]),!t)throw Error(`No data plugin found for context '${e}'`);return t}getDataPlugins(e){let t=this._dataPlugins[e]&&this._dataPlugins[e].length>0&&this._dataPlugins[e];if(t||(t=this._dataPlugins.default&&this._dataPlugins.default.length>0&&this._dataPlugins.default),!t)throw Error(`No data plugin found for context '${e}'`);return t}async read(e,t){return await this.getDataPlugin(e).read(e,t)}async write(e,t,i){const s=this.getDataPlugins(e);if(Array.isArray(s)){let a=null;for(let r=0;r<s.length;++r)a=await s[r].write(e,t,i);return a}else{if(s)return await s.write(e,t,i);this.player.log.warn(`No such data plugin found for context '${e}'`)}}async remove(e,t){const i=this.getDataPlugins(e);if(i.length>1){let s=null;for(let a=0;a<i.length;++a)s=await i[a].remove(e,t);return s}else return await i.remove(e,t)}}let Pt=null;class Ge extends Ce{static Get(){return Pt||(Pt=new Ge),Pt}get moduleName(){return"paella-core default data plugins"}get moduleVersion(){return be.version}}class es extends Lt{getPluginModuleInstance(){return Ge.Get()}get name(){return super.name||"es.upv.paella.cookieDataPlugin"}serializeKey(e,t){return typeof t=="object"&&(t=JSON.stringify(t)),`${e}|${t}`}async read(e,t){const i=this.serializeKey(e,t);let s=j(i);try{s=JSON.parse(s)}catch{}return this.player.log.debug(`CookieDataPlugin.read: ${i}`),s}async write(e,t,i){const s=this.serializeKey(e,t);if(i&&typeof i=="object")try{i=JSON.stringify(i)}catch{this.player.log.warn(`CookieDataPlugin.write: ${s}: invalid data object.`),i=""}ie(s,i),this.player.log.debug(`CookieDataPlugin.write: ${s}`)}async remove(e,t){const i=this.serializeKey(e,t);ie(i,""),this.player.log.debug(`CookieDataPlugin.remove: ${i}`)}}class ts extends Lt{getPluginModuleInstance(){return Ge.Get()}get name(){return super.name||"es.upv.paella.localStorageDataPlugin"}serializeKey(e,t){return typeof t=="object"&&(t=JSON.stringify(t)),`${e}|${t}`}async read(e,t){const i=this.serializeKey(e,t);let s=localStorage.getItem(i);try{s=JSON.parse(s)}catch{}return this.player.log.debug(`LocalStorageDataPlugin.read: ${i}`),s}async write(e,t,i){const s=this.serializeKey(e,t);if(i&&typeof i=="object")try{i=JSON.stringify(i)}catch{this.player.log.warn(`LocalStorageDataPlugin.write: ${s}: invalid data object.`),i=""}localStorage.setItem(s,i),this.player.log.debug(`LocalStorageDataPlugin.write: ${s}`)}async remove(e,t){const i=this.serializeKey(e,t);localStorage.setItem(i,""),this.player.log.debug(`LocalStorageDataPlugin.remove: ${i}`)}}const Vi=[{plugin:Xt,config:{enabled:!1}},{plugin:ei,config:{enabled:!1}},{plugin:si,config:{enabled:!1}},{plugin:ri,config:{enabled:!1}},{plugin:li,config:{enabled:!1}},{plugin:_i,config:{enabled:!1}},{plugin:bi,config:{enabled:!1}},{plugin:Li,config:{enabled:!1}},{plugin:wt,config:{enabled:!1}},{plugin:Ii,config:{enabled:!1}},{plugin:Qn,config:{enabled:!1}},{plugin:ki,config:{enabled:!1}},{plugin:Yn,config:{enabled:!1}},{plugin:wt,config:{enabled:!1}},{plugin:Ai,config:{enabled:!1}},{plugin:Xn,config:{enabled:!1}},{plugin:Ri,config:{enabled:!1}},{plugin:es,config:{enabled:!1,context:["default"]}},{plugin:ts,config:{enable:!0,context:["default"]}}];class Ui extends Oe{constructor(){super(...arguments),this._refreshContent=!0}set refreshContent(e){this._refreshContent=e}get refreshContent(){return this._refreshContent}get closeParentPopUp(){return this.config.closeParentPopUp||this.getCloseParentPopUp()}getCloseParentPopUp(){return!1}async action(e,t){super.action(e,t),this.parentPopUp=t,await this.showPopUp()}get parentPopUp(){return this._parentPopUp}set parentPopUp(e){this._parentPopUp=e}get popUp(){return this._popUp}get menuTitle(){return this.config.menuTitle||null}get moveable(){return this.config.moveable??!1}get resizeable(){return this.config.resizeable??!1}get customPopUpClass(){return this.config.customPopUpClass??""}get closeActions(){var i,s;const e=((i=this.config.closeActions)==null?void 0:i.clickOutside)??!0,t=((s=this.config.closeActions)==null?void 0:s.closeButton)??!1;return{clickOutside:e,closeButton:t}}get currentContent(){return this._currentContent}async getContent(){return b("<p>Pop Up Button Plugin Content</p>")}async checkRefreshContent(){if(this.refreshContent){const e=await this.getContent();this._currentContent.innerHTML="",Array.from(e.children).forEach(i=>this._currentContent.appendChild(i))}}get popUpType(){return this.config.popUpType||"modal"}hidePopUp(){this.player.playbackBar.popUp.isHidden||this.player.playbackBar.popUp.hide()}async showPopUp(){this._keyEventHandler||(this._keyEventHandler=t=>{t.key==="Escape"&&this.hidePopUp()},this.button.addEventListener("keydown",this._keyEventHandler));const e=this.player.playbackBar.popUp;if(e.isHidden||this._contentId!==e.currentContentId){const t=await this.getContent();this._currentContent=t,this._contentId=e.show({title:this.menuTitle||this.description,content:t,attachRight:this.popUpType==="timeline"||this.side==="right",attachLeft:this.popUpType==="timeline"||this.side==="left",parent:this.parentPopUp})}else e.hide()}}const is=n=>n?`<span class="menu-title">${n}</span>`:"",ns=n=>n?`<i class="menu-icon">${n}</i>`:"",ss=n=>n?`aria-label="${n}"`:"",as=n=>n?`<span class="state-text">${n}</span>`:"",rs=n=>n?`<i class="state-icon">${n}</i>`:"",os=(n,e)=>n||e?`<span class="button-state">${as(n)}${rs(e)}</span>`:"";function ls(n,e,t,i,s,a,r){const{id:o=0,title:l=null,icon:d=null,showTitle:y=!0,stateText:g=null,stateIcon:m=null}=n,_=this,L=document.createElement("li"),P=a[o]??!1,C=b(`
		<button class="menu-button-item${P?" selected":""}" ${ss(l)} data-id="${o}"" id="${_.name}_menuItem_${o}">
			${ns(d)}
			${y?is(l):""}
			${g||m?os(g,m):""}
		</button>
	`);return r&&(r._button=C),C.addEventListener("keydown",u=>{var S;const v=()=>{u.stopPropagation(),u.preventDefault()};if(u.key==="ArrowUp"){const f=C.dataPrev;f==null||f.focus(),v()}else if(u.key==="ArrowDown"){const f=C.dataNext;f==null||f.focus(),v()}else if(u.key==="Tab"){const f=u.shiftKey?u.target.dataPrev:u.target.dataNext;f==null||f.focus(),v()}else u.key==="Escape"&&(this.player.playbackBar.popUp.pop()?(S=_.button)==null||S.focus():this.focus(),v())}),C.addEventListener("click",async u=>{var v;if(e==="check"){const S=i.find(f=>f.id===o);a[o]=!a[o],_.itemSelected(S,i)}else if(e==="radio"){a[o]=!0;let S=null;i.forEach(f=>{f.id===o?S=f:a[f.id]=!1}),_.itemSelected(S,i)}else{const S=i.find(f=>f.id===o);_.itemSelected(S,i)}await _.checkRefreshContent(),u.stopPropagation(),_.closeOnSelect&&(_.closeMenu(),(v=_.button)==null||v.focus())}),L.appendChild(C),t.appendChild(L),L}class Ni extends Ui{get closeOnSelect(){return this.config.closeOnSelect===void 0&&(this.buttonType!=="check"?this.config.closeOnSelect=!0:this.config.closeOnSelect=!1),this.config.closeOnSelect}setSelected(e,t){this._selectedItems&&(this._selectedItems[e]=t)}async getContent(){var r,o;const e=(r=document.activeElement)==null?void 0:r.id,t=b("<menu></menu>");this._content=t;const i=await this.getMenu();this._menuItems=i,this._selectedItems||(this._selectedItems={},this._menuItems.forEach(l=>{l.selected!==void 0&&l.selected!==null&&(this._selectedItems[l.id]=l.selected)}));const s=self.crypto.randomUUID(),a=i.map(l=>ls.apply(this,[l,typeof this.buttonType=="function"?this.buttonType():this.buttonType,t,i,s,this._selectedItems,l.plugin]));return a.forEach((l,d,y)=>{const g=l.querySelector("button");let m=y[d+1],_=y[d-1];d===y.length-1&&(m=y[0]),d===0&&(_=y[y.length-1]),g.dataNext=m==null?void 0:m.querySelector("button"),g.dataPrev=_==null?void 0:_.querySelector("button")}),this._firstItem=(o=a[0])==null?void 0:o.querySelector("button"),e&&setTimeout(()=>{var l;(l=document.getElementById(e))==null||l.focus()},10),t}get menuTitle(){return this.config.menuTitle||null}async getMenu(){return[{id:0,title:"Option 1"},{id:1,title:"Option 2"},{id:2,title:"Option 3"},{id:3,title:"Option 4"},{id:4,title:"Option 5"}]}get menuItems(){return this._menuItems}get showTitles(){return!0}get buttonType(){return"radio"}itemSelected(e,t){this.player.log.warn(`MenuButtonPlugin (${this.name}): itemSelected() function not implemented.`)}closeMenu(){this.player.playbackBar.popUp.hide()}async showPopUp(){this.refreshContent=!0,await super.showPopUp(),this.player.containsFocus&&this._firstItem&&this._firstItem.focus()}}class Fi extends Ni{get closeOnSelect(){return this.config.closeOnSelect??!1}async load(){this._iconPath&&(this.icon=await Mt(this._iconPath))}async getContent(){return this._buttonPlugins||(this._buttonPlugins=[],await V(this.player,"button",async e=>{this.player.log.debug(`Load button plugins into "${this.groupName}" container`),this._buttonPlugins.push(e),e.setObserver(this)},async e=>e.parentContainer===this.groupName?await e.isEnabled():!1)),await super.getContent()}onIconChanged(e,t,i){}onTitleChanged(e,t,i){}onStateChanged(e,t,i,s,a){}get groupName(){var e;return((e=this.config)==null?void 0:e.groupName)||"buttonGroup"}get popUpType(){return"no-modal"}getClosePopUps(){return!1}buttonType(){return"button"}async getMenu(){return this._buttonPlugins.map(e=>({id:e.name,title:e.title||e.description,icon:e.icon,plugin:e}))}itemSelected(e,t){const i=this._buttonPlugins.find(s=>s.name===e.id);if(i){const s=new Event("menuitemselected");i.action(s,this.currentContent)}}async showPopUp(){var e;await super.showPopUp(),setTimeout(()=>{this._firstItem&&this._firstItem.focus()},50),(e=this.buttons)==null||e.forEach(t=>{t.style.display==="none"?this.hideButtonContainer(t):this.showButtonContainer(t)})}get buttons(){return this._content&&Array.from(this._content.getElementsByClassName("button-plugin"))}hideButtonContainer(e){var i;const t=(i=e.parentNode)==null?void 0:i.parentNode;t&&(t.style.display="none")}showButtonContainer(e){var i;const t=(i=e.parentNode)==null?void 0:i.parentNode;t&&(t.style.display=null)}}const Et=(n,e,t,i={})=>{const s=new n(e,t);return t=s.name||t,t?(e.config.plugins&&e.config.plugins[t]&&_e(i,e.config.plugins[t],!1),s._config=i,s):(e.log.warn(`The instance of the ${n.name} plugin cannot be created because it is being loaded explicitly and does not have the name property implemented.`),null)};function St(n,e,t,i,s=!1){const a=t.type;let r=-1;if(n.__pluginData__.pluginInstances[a]&&n.__pluginData__.pluginInstances[a].find((l,d)=>{if(l.name===t.name)return r=d,!0})&&!s){n.log.info(`Plugin ${t.name} of type ${a} already registered.`);return}n.__pluginData__.pluginClasses[e]=i,n.__pluginData__.pluginInstances[a]=n.__pluginData__.pluginInstances[a]||[],r!==-1&&n.__pluginData__.pluginInstances[a].splice(r,1),n.__pluginData__.pluginInstances[a].push(t),n.__pluginModules=n.__pluginModules||[];const o=t.getPluginModuleInstance();if(o&&(o._player=o._player||n,!n.__pluginModules.find(l=>l.constructor.name===o.constructor.name))){const l=o.moduleName,d=o.moduleVersion;n.log.debug(`Plugin module imported: ${l}: v${d}`),n.__pluginModules.push(o)}}function cs(n,e){let t=null,i={enabled:!0};if(typeof e=="function"?t=e:typeof e=="object"&&typeof e.plugin=="function"&&(t=e.plugin,i=e.config),!t)n.log.warn("Error importing plugin with explicit import API. Check the 'plugins' array at init params");else{const s=Et(t,n,null,i);if(!s)n.log.warn(`Unable to create an instance of the plugin ${t.name}`);else{const a=s.constructor.name;St(n,a,s,t,!0)}}}function us(n,e){const t=n.config;e.keys().forEach(i=>{const s=e(i),a=i.substring(2,i.length-3);if(t.plugins[a]){const r=s.default,o=Et(r,n,a,{});St(n,i,o,r,!1)}else if(/^[a-z0-9]+$/i.test(a)){n.__pluginModules=n.__pluginModules||[];const r=s.default,o=new r(n);if(!n.__pluginModules.find(l=>l.constructor.name===o.constructor.name)){const l=o.moduleName,d=o.moduleVersion;n.log.debug(`Plugin module imported: ${l}: v${d}`),n.__pluginModules.push(o)}}})}function ds(n){const e=n.config;if(n.__pluginData__=n.__pluginData__||{pluginClasses:[],pluginInstances:{}},n.__pluginData__.pluginClasses.length!==0)return;[...Vi,...n.initParams.plugins].forEach(i=>{cs(n,i)});const{buttonGroups:t}=e;t&&t.forEach((i,s)=>{const a=`button_group_${s}`,r=Et(Fi,n,a,i);r._iconPath=G([n.configResourcesUrl,i.icon]),St(n,r.type,r,`ButtonGroupPlugin${s}`,!1)}),n.log.debug("Plugins have been registered:")}function hs(n){delete n.__pluginData__}function Tt(n,e){var t;return((t=n.__pluginData__)==null?void 0:t.pluginInstances[e])||[]}async function V(n,e,t=null,i=null){if(!n.__pluginData__.pluginInstances[e]){n.log.info(`There are no defined plugins of type '${e}'`);return}n.__pluginData__.pluginInstances[e].sort((s,a)=>s.order-a.order),n.__pluginData__.pluginInstances[e].forEach(s=>n.log.debug(`type: ${e}, name: ${s.name}`)),typeof i!="function"&&(i=async function(s){return await s.isEnabled()});for(const s in n.__pluginData__.pluginInstances[e]){const a=n.__pluginData__.pluginInstances[e][s];if(await i(a)){if(a.__uiPlugin){const o=await a.getDictionaries();if(typeof o=="object")for(const l in o){const d=o[l];n.addDictionary(l,d)}}typeof t=="function"&&await t(a),await a.load()}}}async function Oi(n,e){var t;(t=n.__pluginData__.pluginInstances[e])==null||t.forEach(async i=>{await i.unload()})}function $i(n){var t;const e=(i,s)=>{if(!i)throw new Error(`Invalid video manifest: ${s}`)};e(n.streams,"missing 'streams' object."),e(n.streams.length>0,"the 'streams' array is empty."),e((t=n.metadata)==null?void 0:t.preview,"the 'metadata.preview' field is required.")}class ps extends ne{constructor(e,t){super(e,t),this._videoContainer=t,this._streamData=null,this._streams=null,this._players=[],this._mainAudioPlayer=null,this._streamSyncTimer=null,this._trimming={enabled:!1,start:100,end:200}}async load(e){this._streamData=e,this._streams={};let t=this.player.config.defaultAudioStream||"presenter";this._streamData.length===1&&(t=this._streamData[0].content),e.some(i=>{if(i.role==="mainAudio")return t=i.content,!0}),this.player.log.debug("Finding compatible video plugins"),await $n(this.player);for(const i of this._streamData){const s=Gn(this.player,i);if(!s)throw Error(`Canvas plugin not found: ${i.canvas}`);const a=i.content===t,r=await mn(this.player,i);if(!r)throw Error(`Incompatible stream type: ${i.content}`);this._streams[i.content]={stream:i,isMainAudio:a,videoPlugin:r,canvasPlugin:s}}for(const i in this._streams){const s=this._streams[i];s.canvas=await s.canvasPlugin.getCanvasInstance(this._videoContainer),s.player=await s.videoPlugin.getVideoInstance(s.canvas.element,s.isMainAudio),t===i?(this._mainAudioPlayer=s.player,s.player.initVolume(1)):s.player.initVolume(0),await s.player.load(s.stream,this),await s.canvas.loadCanvas(s.player),s.player.onVideoEnded(()=>{this.executeAction("pause"),this.executeAction("setCurrentTime",0),ee(this.player,p.ENDED)}),this._players.push(s.player)}if(this.mainAudioPlayer===null)throw this.player.log.error("The video stream containing the audio track could not be identified. The `role` attribute must be specified in the main video stream, or the `defaultAudioStream` attribute must be set correctly in the player configuration."),new Error("The video stream containing the audio track could not be identified.")}async unload(){this.stopStreamSync(),await Bn(this.player)}get players(){return this._players}get streamData(){return this._streamData}get streams(){return this._streams}get mainAudioPlayer(){return this._mainAudioPlayer}get isTrimEnabled(){var e,t,i;return((e=this._trimming)==null?void 0:e.enabled)&&((t=this._trimming)==null?void 0:t.end)>((i=this._trimming)==null?void 0:i.start)}get trimStart(){var e;return(e=this._trimming)==null?void 0:e.start}get trimEnd(){var e;return(e=this._trimming)==null?void 0:e.end}async setTrimming({enabled:e,start:t,end:i}){if(t>=i)throw Error(`Error setting trimming: start time (${t}) must be lower than end time ${i}`);this._trimming={enabled:e,start:t,end:i};const s=await this.currentTime();ee(this.player,p.TIMEUPDATE,{currentTime:e?t+s:s})}startStreamSync(){this._timeSync=!0;const e=async()=>{if(!this._players.length){this.player.log.warn("Player not yet loaded. Waiting for video sync.");return}let t=this.mainAudioPlayer.currentTimeSync;const i=.2;if(this.players.length>1)for(let s=0;s<this.players.length;++s){const a=this.players[s];if(a!==this.mainAudioPlayer){const r=a.currentTimeSync;Math.abs(t-r)>i&&(this.player.log.debug("Video synchronization triggered"),a.setCurrentTime(t))}}if(this.isTrimEnabled){let s=t-this.trimStart;if(this.trimEnd<=t){await this.executeAction("pause"),await this.setCurrentTime(0),this.stopStreamSync(),t=0,ee(this.player,p.ENDED,{});return}else t<this.trimStart&&(await this.setCurrentTime(0),t=this.trimStart,s=0);ee(this.player,p.TIMEUPDATE,{currentTime:s}),this._timeupdateTimer=setTimeout(()=>{this._timeSync&&e()},250)}else this._timeSync&&(ee(this.player,p.TIMEUPDATE,{currentTime:t}),this._timeupdateTimer=setTimeout(()=>{e()},250))};e()}stopStreamSync(){this._timeSync=!1,this._timeupdateTimer&&clearTimeout(this._timeupdateTimer)}executeAction(e,t=[]){return Array.isArray(t)||(t=[t]),new Promise(i=>{let s=[],a=[];this.players.forEach(r=>{a.push(new Promise(o=>{r[e](...t).then(l=>{s.push(l),o()})}))}),Promise.allSettled(a).then(()=>i(s))})}get isLiveStream(){return this._streamData.some(e=>Array.from(Object.keys(e.sources)).indexOf("hlsLive")!==-1)}async play(){return this.startStreamSync(),await this.executeAction("play")}async pause(){return this.stopStreamSync(),await this.executeAction("pause")}async stop(){this.stopStreamSync(),await this.executeAction("pause"),await this.executeAction("setCurrentTime",0)}async paused(){return(await this.executeAction("paused"))[0]}async setCurrentTime(e){const t=await this.duration();e<0?e=0:e>t&&(e=t);const i=(await this.executeAction("currentTime"))[0];let s=null;if(this.isTrimEnabled){e=e+this.trimStart,e=e>=this.trimEnd?this.trimEnd:e;const r=(await this.executeAction("setCurrentTime",[e]))[0],o=(await this.executeAction("currentTime"))[0];s={result:r,prevTime:i-this.trimStart,newTime:o-this.trimStart}}else{const r=(await this.executeAction("setCurrentTime",[e]))[0],o=(await this.executeAction("currentTime"))[0];s={result:r,prevTime:i,newTime:o}}const a=await this.currentTime();return ee(this.player,p.TIMEUPDATE,{currentTime:a}),s}async currentTime(){const e=await this.mainAudioPlayer.currentTime();return this.isTrimEnabled?e-this.trimStart:e}async currentTimeIgnoringTrimming(){return await this.mainAudioPlayer.currentTime()}async volume(){return this.mainAudioPlayer?await this.mainAudioPlayer.volume():(await this.executeAction("volume"))[0]}async setVolume(e){return this.mainAudioPlayer?await this.mainAudioPlayer.setVolume(e):(await this.executeAction("setVolume",[e]))[0]}async duration(){return this.isTrimEnabled?this.trimEnd-this.trimStart:await this.durationIgnoringTrimming()}async durationIgnoringTrimming(){return(await this.executeAction("duration")).reduce((t,i)=>Math.min(t,i),Number.MAX_VALUE)}async playbackRate(){return(await this.executeAction("playbackRate"))[0]}async setPlaybackRate(e){return(await this.executeAction("setPlaybackRate",[e]))[0]}async getQualityReferencePlayer(){let e=null,t=[];if(Object.keys(this.streams).length>0)for(const i in this.streams){const s=this.streams[i],a=await s.player.getQualities()||[];!e&&a.length>t.length&&(t=a,e=s.player)}return e||this.mainAudioPlayer}async getCurrentQuality(){return(await this.getQualityReferencePlayer()).currentQuality}async getQualities(){return await(await this.getQualityReferencePlayer()).getQualities()}async setQuality(e){const i=await(await this.getQualityReferencePlayer()).getQualities(),s=i.length;let a=-1;if(i.some((r,o)=>(e.index===r.index&&(a=o),a!==-1)),a>=0){const r=a/s;for(const o in this.streams){const l=this.streams[o],d=await l.player.getQualities()||[];if(this.player.log.debug(d),d.length>1){const y=Math.round(d.length*r),g=d[y];await l.player.setQuality(g)}}}}async supportsMultiaudio(){return this.mainAudioPlayer.supportsMultiaudio()}async getAudioTracks(){return this.mainAudioPlayer.getAudioTracks()}async setCurrentAudioTrack(e){return this.mainAudioPlayer.setCurrentAudioTrack(e)}get currentAudioTrack(){return this.mainAudioPlayer.currentAudioTrack}}const U=Object.freeze({TOP_LEFT:"topLeft",TOP_MIDDLE:"topMiddle",TOP_RIGHT:"topRight",CENTER_LEFT:"centerLeft",CENTER_MIDDLE:"centerMiddle",CENTER_RIGHT:"centerRight",BOTTOM_LEFT:"bottomLeft",BOTTOM_MIDDLE:"bottomMiddle",BOTTOM_RIGHT:"bottomRight"}),z=(n,e,t,i,s)=>{i=i||"",t=t||1e3;const a=b(`
        <div class="message-content ${i}">
            ${n?`<i class="icon">${n}</i>`:""}
            ${e?`<p class="text">${e}</p>`:""}
        </div>
    `);return s.innerHTML="",s.appendChild(a),s.timer&&(clearTimeout(s.timer),s.timer=null),s.timer=setTimeout(()=>{s.removeChild(a)},t),a};class gs extends O{constructor(e,t){const i={class:"video-container-message"};super(e,{attributes:i,parent:t}),this._topLeftContainer=b('<div class="container top-left"></div>',this.element),this._topMiddleContainer=b('<div class="container top-middle"></div>',this.element),this._topRightContainer=b('<div class="container top-right"></div>',this.element),this._centerLeftContainer=b('<div class="container center-left"></div>',this.element),this._centerMiddleContainer=b('<div class="container center-middle"></div>',this.element),this._centerRightContainer=b('<div class="container center-right"></div>',this.element),this._bottomLeftContainer=b('<div class="container bottom-left"></div>',this.element),this._bottomMiddleContainer=b('<div class="container bottom-middle"></div>',this.element),this._bottomRightContainer=b('<div class="container bottom-right"></div>',this.element)}show({icon:e=null,text:t="",timeout:i=1e3,position:s=U.CENTER_MIDDLE,cssClass:a=""}){switch(s){case U.TOP_LEFT:z.apply(this,[e,t,i,a,this._topLeftContainer]);break;case U.TOP_MIDDLE:z.apply(this,[e,t,i,a,this._topMiddleContainer]);break;case U.TOP_RIGHT:z.apply(this,[e,t,i,a,this._topRightContainer]);break;case U.CENTER_LEFT:z.apply(this,[e,t,i,a,this._centerLeftContainer]);break;case U.CENTER_MIDDLE:z.apply(this,[e,t,i,a,this._centerMiddleContainer]);break;case U.CENTER_RIGHT:z.apply(this,[e,t,i,a,this._centerRightContainer]);break;case U.BOTTOM_LEFT:z.apply(this,[e,t,i,a,this._bottomLeftContainer]);break;case U.BOTTOM_MIDDLE:z.apply(this,[e,t,i,a,this._bottomMiddleContainer]);break;case U.BOTTOM_RIGHT:z.apply(this,[e,t,i,a,this._bottomRightContainer]);break}}}const w=Object.freeze({UNLOADED:0,LOADING_MANIFEST:1,MANIFEST:2,LOADING_PLAYER:3,LOADED:4,UNLOADING_MANIFEST:5,UNLOADING_PLAYER:6,ERROR:7});function ms(n,e){return Array.isArray[e]||(e=[e]),gn(n,e).getManifestData(e)}async function fs(n){return{w:1280,h:720}}async function Bi(n){var e;for(const t in this.streamProvider.streams){const i=((e=n==null?void 0:n.videos)==null?void 0:e.find(a=>a.content===t))!=null,s=this.streamProvider.streams[t];i&&!s.player.isEnabled?await s.player.enable():!i&&s.player.isEnabled&&await s.player.disable()}}function Gi(){for(const n in this.streamProvider.streams){const e=this.streamProvider.streams[n];e.canvas.element.style.display="none",this._hiddenVideos.appendChild(e.canvas.element)}}async function ys(){var a,r;const n=Si(this.player,this.streamProvider.streamData,this._layoutId,this._mainLayoutContent);await Bi.apply(this,[n]),Gi.apply(this);const e=await fs(this.player),t=100/e.w,i=100/e.h;if(this.baseVideoRect.classList.remove("dynamic"),this.baseVideoRect.classList.add("static"),(a=n==null?void 0:n.videos)!=null&&a.length){const o=[];for(const l of n.videos){const d=this.streamProvider.streams[l.content],{stream:y,player:g,canvas:m}=d,_=await g.getDimensions(),L=_.w/_.h;let P=Number.MAX_VALUE,C=null;m.buttonsArea.innerHTML="",o.push(await gt(this.player,n,m,l,l.content)),l.rect.forEach(u=>{const v=/^(\d+.?\d*)\/(\d+.?\d*)$/.exec(u.aspectRatio),S=v?Number(v[1])/Number(v[2]):1,f=Math.abs(L-S);f<P&&(C=u,P=f)}),m.element.style.display="block",m.element.style.position="absolute",m.element.style.left=`${(C==null?void 0:C.left)*t}%`,m.element.style.top=`${(C==null?void 0:C.top)*i}%`,m.element.style.width=`${(C==null?void 0:C.width)*t}%`,m.element.style.height=`${(C==null?void 0:C.height)*i}%`,m.element.style.zIndex=l.layer,this.baseVideoRect.appendChild(m.element)}setTimeout(()=>{mt(this.player,n,o.flat())},100)}const s=this.baseVideoRect.getElementsByClassName("video-layout-button");return Array.from(s).forEach(o=>this.baseVideoRect.removeChild(o)),(r=n==null?void 0:n.buttons)==null||r.forEach(o=>{const l=Ye({tag:"button",attributes:{class:"video-layout-button","aria-label":he(o.ariaLabel),title:he(o.title),style:`
                    left: ${o.rect.left*t}%;
                    top: ${o.rect.top*i}%;
                    width: ${o.rect.width*t}%;
                    height: ${o.rect.height*i}%;
                    z-index: ${o.layer};
                `},parent:this.baseVideoRect,children:o.icon});l.layout=n,l.buttonAction=o.onClick,l.addEventListener("click",async d=>{E(this.player,p.BUTTON_PRESS,{plugin:n.plugin,layoutStructure:n}),await d.target.buttonAction.apply(d.target.layout),d.stopPropagation()}),this._layoutButtons.push(l)}),!0}async function vs(){var r,o,l,d,y,g;const n=Si(this.player,this.streamProvider.streamData,this._layoutId,this._mainLayoutContent);await Bi.apply(this,[n]),Gi.apply(this),this.baseVideoRect.classList.add("dynamic"),this.baseVideoRect.classList.remove("static"),this.baseVideoRect.innerHTML="";const e=this.element.clientWidth,t=this.element.clientHeight,i=e>t;if(this.baseVideoRect.classList.remove("align-center"),this.baseVideoRect.classList.remove("align-top"),this.baseVideoRect.classList.remove("align-bottom"),this.baseVideoRect.classList.remove("align-left"),this.baseVideoRect.classList.remove("align-right"),i){const m=((o=(r=this.player.config.videoContainer)==null?void 0:r.dynamicLayout)==null?void 0:o.landscapeVerticalAlignment)||"align-center";this.baseVideoRect.classList.remove("portrait"),this.baseVideoRect.classList.add("landscape"),this.baseVideoRect.classList.add(m)}else{const m=((d=(l=this.player.config.videoContainer)==null?void 0:l.dynamicLayout)==null?void 0:d.portraitHorizontalAlignment)||"align-center";this.baseVideoRect.classList.add("portrait"),this.baseVideoRect.classList.remove("landscape"),this.baseVideoRect.classList.add(m)}const s=this.baseVideoRect.clientWidth,a=this.element.clientHeight;if(((y=n==null?void 0:n.videos)==null?void 0:y.length)===1){const m=[],_=[],L=n.videos[0],P=this.streamProvider.streams[L.content],{player:C,canvas:u}=P;u.buttonsArea.innerHTML="",_.push(await gt(this.player,n,u,L,L.content)),u.element.style={},u.element.style.display="block",u.element.style.width="100%",u.element.style.height="100%",u.element.style.overflow="hidden",u.element.style.position="relative",m.push(u.element),u.element.sortIndex=0,m.forEach(v=>this.baseVideoRect.appendChild(v)),setTimeout(()=>{mt(this.player,n,_.flat())},100)}else if((g=n==null?void 0:n.videos)!=null&&g.length){let m=0;const _=[],L=[];for(const P of n.videos){const C=this.streamProvider.streams[P.content],{player:u,canvas:v}=C,S=await u.getDimensions(),f=S.w/S.h,K=s,ce=a,J=(i?K:ce)*P.size/100;let X=Math.round(i?J:J*f),B=Math.round(i?J/f:J);X>K&&(X=K,B=Math.round(X/f)),B>ce&&(B=ce,X=Math.round(B*f)),v.buttonsArea.innerHTML="",L.push(await gt(this.player,n,v,P,P.content)),v.element.style={},v.element.style.display="block",v.element.style.width=`${X}px`,v.element.style.height=`${B}px`,v.element.style.overflow="hidden",v.element.style.position="relative",v.element.sortIndex=m++,_.push(v.element)}if(i){const P=b('<div class="landscape-container"></div>',this.baseVideoRect);_.forEach(C=>P.appendChild(C))}else _.forEach(P=>this.baseVideoRect.appendChild(P));setTimeout(()=>{mt(this.player,n,L.flat())},100)}return!0}class _s extends O{constructor(e,t){var r;const i="base-video-rect",s={class:"video-container"};(r=e.config.videoContainer)!=null&&r.overPlaybackBar&&(s.class+=" over-playback-bar");const a=`
            <div class="${i}"></div>
            <div class="hidden-videos-container" style="display: none"></div>
        `;super(e,{attributes:s,children:a,parent:t}),this._hiddenVideos=this.element.getElementsByClassName("hidden-videos-container")[0],this._baseVideoRect=this.element.getElementsByClassName(i)[0],this.element.addEventListener("click",async()=>{await this.paused()?await this.play():await this.pause()}),this._ready=!1,this._players=[],this._streamProvider=new ps(this.player,this.baseVideoRect)}get layoutId(){return this._layoutId}get mainLayoutContent(){return this._mainLayoutContent}async setLayout(e,t=null){var i,s;if(this.validContentIds.indexOf(e)===-1)return!1;{const a=(s=(i=this.player.config.videoContainer)==null?void 0:i.restoreVideoLayout)==null?void 0:s.global;await this.player.preferences.set("videoLayout",e,{global:a}),await this.player.preferences.set("videoLayoutMainContent",t,{global:a});const r=this._layoutId;this._layoutId=e,this._mainLayoutContent=t,await this.updateLayout(),r!==e&&E(this.player,p.LAYOUT_CHANGED,{prevLayout:r,layoutId:e})}}get validContentIds(){return this._validContentIds}get validContentSettings(){return this._validContentSettings}get validLayouts(){return $e(this.player,this.streamData)}get streamData(){return this._streamData}get baseVideoRect(){return this._baseVideoRect}get streamProvider(){return this._streamProvider}async create(){this._baseVideoRect.style.display="none",await V(this.player,"layout"),await hn(this.player)}async load(e){var o,l,d,y,g,m,_,L,P,C;if(this._streamData=e,(l=(o=this.player.config.videoContainer)==null?void 0:o.restoreVideoLayout)!=null&&l.enabled){const u=(y=(d=this.player.config.videoContainer)==null?void 0:d.restoreVideoLayout)==null?void 0:y.global;this._layoutId=await this.player.preferences.get("videoLayout",{global:u})||this.player.config.defaultLayout,this._mainLayoutContent=await this.player.preferences.get("videoLayoutMainContent",{global:u})||null}else this._layoutId=this.player.config.defaultLayout,this._mainLayoutContent=null;await this.streamProvider.load(e),this._validContentIds=Pi(this.player,e),this._validContentSettings=Un(this.player,e),await this.updateLayout(null,!0);const t=b('<div class="button-plugins left-side"></div>',this.element),i=b('<div class="button-plugins right-side"></div>',this.element);this._buttonPlugins=[t,i],this.player.log.debug("Loading videoContainer button plugins"),await V(this.player,"button",async u=>{this.player.log.debug(` Button plugin: ${u.name}`),u.side==="left"?await Fe(u,t):u.side==="right"&&await Fe(u,i)},async u=>u.parentContainer==="videoContainer"?await u.isEnabled():!1),this._baseVideoRect.style.display="";const s=await this.player.preferences.get("volume",{global:!0}),a=await this.player.preferences.get("playbackRate",{global:!0}),r=await this.player.preferences.get("lastKnownTime",{global:!1});if((g=this.player.config.videoContainer)!=null&&g.restoreVolume&&s!==null&&s!==void 0&&await this.streamProvider.setVolume(s),(m=this.player.config.videoContainer)!=null&&m.restorePlaybackRate&&a!==null&&a!==void 0&&await this.streamProvider.setPlaybackRate(a),this.player.videoManifest.trimming&&await this.player.videoContainer.setTrimming(this.player.videoManifest.trimming),(L=(_=this.player.config.videoContainer)==null?void 0:_.restoreLastTime)!=null&&L.enabled&&!this.streamProvider.isLiveStream){const u=async()=>{if(!await this.paused()){const S=await this.currentTime();await this.player.preferences.set("lastKnownTime",S,{global:!1})}setTimeout(u,1e3)};if(r){const v=await this.player.preferences.get("lastKnownTime",{global:!1}),S=await this.duration(),f=(C=(P=this.player.config.videoContainer)==null?void 0:P.restoreLastTime)==null?void 0:C.remainingSeconds;S-v>f&&await this.setCurrentTime(v)}u()}this._messageContainer=new gs(this.player,this.element),this._ready=!0}async unload(){this.removeFromParent(),await Oi(this.player,"layout"),await pn(this.player),await this.streamProvider.unload()}async updateLayout(e=null){const t=arguments[1];if(e&&(this._mainLayoutContent=e),!t&&this.player.state!==w.LOADED)return;if(this._updateInProgress)return this.player.log.warn("Recursive update layout detected"),!1;this._updateInProgress=!0;let i=!0;this._layoutButtons=[],(!this._layoutId||this._validContentIds.indexOf(this._layoutId)===-1)&&(this._layoutId=this.player.config.defaultLayout,this._mainLayoutContent=null,this._validContentIds.indexOf(this._layoutId)===-1&&(this._layoutId=this._validContentIds[0]),i=!1);const s=Ei(this.player,this.streamProvider.streamData,this._layoutId);return s.layoutType==="static"?i=ys.apply(this):s.layoutType==="dynamic"&&(i=vs.apply(this)),this._updateInProgress=!1,i}hideUserInterface(){if(this._layoutButtons&&this._buttonPlugins){this.player.log.debug("Hide video container user interface");const e=t=>{t._prevDisplay=t.style.display,t.style.display="none"};this._layoutButtons.forEach(e),this._buttonPlugins.forEach(e);for(const t in this.streamProvider.streams)this.streamProvider.streams[t].canvas.hideButtons()}}showUserInterface(){if(this._layoutButtons&&this._buttonPlugins){const e=t=>t.style.display=t._prevDisplay||"block";this._layoutButtons.forEach(e),this._buttonPlugins.forEach(e);for(const t in this.streamProvider.streams)this.streamProvider.streams[t].canvas.showButtons()}}get message(){return this._messageContainer}get elementSize(){return{w:this.element.offsetWidth,h:this.element.offsetHeight}}get ready(){return this._ready}get isLiveStream(){return this.streamProvider.isLiveStream}async play(){const e=await this.streamProvider.play();return E(this.player,p.PLAY),e}async pause(){const e=await this.streamProvider.pause();return E(this.player,p.PAUSE),e}async stop(){this.streamProvider.stop(),E(this.player,p.STOP)}async paused(){return this.streamProvider.paused()}async setCurrentTime(e){const t=await this.streamProvider.setCurrentTime(e);return E(this.player,p.SEEK,{prevTime:t.prevTime,newTime:t.newTime}),t.result}async currentTime(){return this.streamProvider.currentTime()}async volume(){return this.streamProvider.volume()}async setVolume(e){const t=await this.streamProvider.setVolume(e);return E(this.player,p.VOLUME_CHANGED,{volume:e}),await this.player.preferences.set("volume",e,{global:!0}),t}async duration(){return await this.streamProvider.duration()}async playbackRate(){return await this.streamProvider.playbackRate()}async setPlaybackRate(e){const t=await this.streamProvider.setPlaybackRate(e);return E(this.player,p.PLAYBACK_RATE_CHANGED,{newPlaybackRate:e}),await this.player.preferences.set("playbackRate",e,{global:!0}),t}get isTrimEnabled(){return this.streamProvider.isTrimEnabled}get trimStart(){return this.streamProvider.trimStart}get trimEnd(){return this.streamProvider.trimEnd}async setTrimming({enabled:e,start:t,end:i}){const s=await this.streamProvider.setTrimming({enabled:e,start:t,end:i});return E(this.player,p.TRIMMING_CHANGED,{enabled:e,start:t,end:i}),s}getVideoRect(e=null){var i;let t=this.baseVideoRect;return typeof e=="string"&&(t=(i=this.streamProvider.streams[e])==null?void 0:i.canvas.element),{x:t==null?void 0:t.offsetLeft,y:t==null?void 0:t.offsetTop,width:t==null?void 0:t.offsetWidth,height:t==null?void 0:t.offsetHeight,element:t}}appendChild(e,t=null,i=1){if(t){const{width:s,height:a}=this.getVideoRect();t.x=t.x*100/s,t.width=t.width*100/s,t.y=t.y*100/a,t.height=t.height*100/a,e.style.position="absolute",e.style.left=`${t.x}%`,e.style.top=`${t.y}%`,e.style.width=`${t.width}%`,e.style.height=`${t.height}%`,i!==null&&(e.style.zIndex=i)}return this.baseVideoRect.appendChild(e),e}removeChild(e){this.baseVideoRect.removeChild(e)}}const ws=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="100%" height="100%" viewBox="0 0 300 300" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
    <rect id="Play" x="0" y="0" width="300" height="300" style="fill:none;"/>
    <g id="Play1" serif:id="Play">
        <g transform="matrix(1.21457,0,0,1.21457,-55.8704,-35.2227)">
            <circle cx="169.5" cy="152.5" r="123.5" style="fill:rgb(128,128,128);"/>
            <path d="M169.5,29C237.662,29 293,84.338 293,152.5C293,220.662 237.662,276 169.5,276C101.338,276 46,220.662 46,152.5C46,84.338 101.338,29 169.5,29ZM169.5,37.233C233.117,37.233 284.767,88.883 284.767,152.5C284.767,216.117 233.117,267.767 169.5,267.767C105.883,267.767 54.233,216.117 54.233,152.5C54.233,88.883 105.883,37.233 169.5,37.233Z" style="fill:rgb(235,235,235);"/>
        </g>
        <g transform="matrix(6.12323e-17,1,-1,6.12323e-17,347,-59)">
            <path d="M209,82L317,253L101,253L209,82Z" style="fill:rgb(235,235,235);"/>
        </g>
    </g>
</svg>
`,Cs=`
    background-color: #e4e4e4;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    position: absolute;
    top: 50%;
    transform: translateY(-50%); 
`,It=`
    width: 100%;
`,bs=`
    position: absolute; 
    top: 0px; 
    left: 0px; 
    right: 0px; 
    bottom: 0px; 
    display: flex;
    align-content: center;
    justify-content: center;
    align-items: center;
`,Ls=`
    pointer-events: none;
    width: 20%;
    max-width: 400px;
    min-width: 100px;
    opacity: 0.6;
`,Ps=`
    display: block;
    width: 20%;
    background: none;
    border: none;
    cursor: pointer;
`;class Es extends O{constructor(e,t,i,s){const a={class:"preview-container",style:Cs,role:"button","aria-label":"Play video"};super(e,{attributes:a,parent:t}),this._img=b(`
        <div style="${It}">
            ${i?`<img style="${It}" src="${i}" class="preview-image-landscape" alt=""/>`:""}
            ${s?`<img style="${It}" src="${s}" class="preview-image-portrait" alt=""/>`:""}
            <div style="${bs}">
                <button style="${Ps}" role="button" aria-label="Play video">
                    <i class="preview-play-icon" style="${Ls}">${ws}</i>
                </button>
            </div>
        </div>
        `,this.element),this.element.setAttribute("id","playerContainerClickArea"),this.element.addEventListener("click",l=>{e.play()});const r=i&&s,o=()=>{if(r){const l=this.element.clientWidth/this.element.clientHeight,d=Array.from(this.element.getElementsByClassName("preview-image-landscape")),y=Array.from(this.element.getElementsByClassName("preview-image-portrait"));l>=1?(d.forEach(g=>g.style.display=""),y.forEach(g=>g.style.display="none")):(d.forEach(g=>g.style.display="none"),y.forEach(g=>g.style.display=""))}};window.addEventListener("resize",()=>{o()}),o()}loadBackgroundImage(e){this._img.setAttribute("src",e)}}const Ss=n=>{const e=document.createElement("section");return e.classList.add("pop-up"),e.innerHTML=`
        <header class="pop-up-title">
            <button class="action-back">
                <svg width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round">
                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                    <path d="M15 6l-6 6l6 6" />
                </svg>
            </button>
            <h2>title</h2>
        </header>
        <div class="pop-up-content">
        </div>
    `,n.appendChild(e),e.setTitle=t=>{e.querySelector("header.pop-up-title h2").textContent=t},e.popButton=()=>e.querySelector("header.pop-up-title button"),e.onPopClicked=t=>{e._clickCallback&&e.popButton().removeEventListener("click",e._clickCallback),e._clickCallback=t,e.popButton().addEventListener("click",t)},e.hidePopButton=()=>e.popButton().style.display="none",e.showPopButton=()=>e.popButton().style.display="",e.setContent=t=>{e.querySelector("div.pop-up-content").innerHTML="",e.querySelector("div.pop-up-content").appendChild(t)},e};let Ts=0;function Is(){return++Ts}class Ds{constructor(e){A(this,oe,null);A(this,k,null);A(this,R,[]);A(this,De,"");M(this,oe,e),M(this,k,document.createElement("div")),h(this,k).className="pop-up-wrapper",e.element.prepend(h(this,k)),h(this,k).classList.add("hidden"),h(this,k).addEventListener("click",t=>t.stopPropagation()),h(this,oe).element.addEventListener("click",t=>{t.stopPropagation(),this.hide()})}get title(){return h(this,De)}set title(e){M(this,De,e)}get currentContent(){return h(this,R).length&&h(this,R)[h(this,R).length-1]}get currentContentId(){var e;return((e=this.currentContent)==null?void 0:e.dataContentId)??-1}show({content:e,title:t="",parent:i=null,attachLeft:s=!1,attachRight:a=!1}){if(!e)throw new Error("PlaybackBarPopUp.show(): No content provided.");e.setAttribute("data-pop-up-content-id",Is()),e.dataContentId=e.getAttribute("data-pop-up-content-id");const r=h(this,R).length&&h(this,R)[h(this,R).length-1],o=i&&i.getAttribute("data-pop-up-content-id");r&&r.getAttribute("data-pop-up-content-id")!==o?(h(this,k).innerHTML="",M(this,R,[])):r&&r.container.classList.add("out"),h(this,R).push(e),h(this,oe).element.classList.add("pop-up-active"),h(this,k).classList.remove("hidden");const l=Ss(h(this,k));return l.setTitle(t),e.container=l,s===!0?h(this,k).classList.add("left"):h(this,k).classList.remove("left"),a===!0?h(this,k).classList.add("right"):h(this,k).classList.remove("right"),l.setContent(e),h(this,R).length>1?l.onPopClicked(()=>{h(this,R).pop(),h(this,R)[h(this,R).length-1].container.classList.remove("out"),h(this,k).removeChild(l)}):l.hidePopButton(),this.title=t,e.dataContentId}pop(){if(h(this,k).querySelectorAll(".pop-up").length===1)return this.hide(),!1;const e=new Event("click");return h(this,k).querySelector(".pop-up:not(.out) .action-back").dispatchEvent(e),!0}hide(){h(this,oe).element.classList.remove("pop-up-active"),h(this,k).classList.add("hidden")}get isHidden(){return h(this,k).classList.contains("hidden")}}oe=new WeakMap,k=new WeakMap,R=new WeakMap,De=new WeakMap;class ks extends O{constructor(t,i){var y;const s=((y=t.config.progressIndicator)==null?void 0:y.inlineMode)??!1;super(t,{attributes:{class:"playback-bar-container"},parent:i});A(this,ke,null);A(this,ge,null);A(this,me,null);A(this,Z,null);A(this,fe,null);A(this,Ae,null);A(this,ye,null);A(this,x,null);A(this,le,!0);A(this,ve,[]);M(this,ke,new Ds(this)),this.element.addEventListener("mouseenter",()=>Nt(t)),this.element.addEventListener("mouseleave",()=>Ft(t)),M(this,ge,b('<section class="playback-bar"></section>',this.element)),M(this,me,b("<div></div>")),M(this,Z,b("<nav></nav>")),M(this,fe,b("<ul></ul>",h(this,Z))),M(this,Ae,b("<div></div>",h(this,Z))),M(this,ye,b("<ul></ul>",h(this,Z)));const r=t._initParams.getProgressIndicator,o=1e3,l=0,d=100;s?M(this,x,r({container:h(this,Ae),player:t,duration:o,currentTime:l,precision:d})):(h(this,ge).appendChild(h(this,me)),M(this,x,r({container:h(this,me),player:t,duration:o,currentTime:l,precision:d}))),h(this,x).onChange(async g=>{await t.videoContainer.setCurrentTime(g)}),h(this,ge).appendChild(h(this,Z))}get popUp(){return h(this,ke)}get enabled(){return h(this,le)}set enabled(t){M(this,le,t),h(this,le)?this.showUserInterface():this.hide()}async load(){M(this,ve,[]),this.player.log.debug("Loading button plugins"),await V(this.player,"button",async i=>{this.player.log.debug(` Button plugin: ${i.name}`),h(this,ve).push(i),i.side==="left"?await Fe(i,this.buttonPluginsLeft):i.side==="right"&&await Fe(i,this.buttonPluginsRight)},async i=>i.parentContainer==="playbackBar"?await i.isEnabled():!1);const t=await this.player.videoContainer.duration();h(this,x).setDuration(t),this.player.frameList.frames.forEach((i,s,a)=>{const r=a[s+1],o=r?r.time-i.time:t-i.time;h(this,x).addMarker({time:i.time,duration:t,frameDuration:o})}),this.player.bindEvent([this.player.Events.TIMEUPDATE,this.player.Events.SEEK],i=>{h(this,x).setCurrentTime(i.newTime??i.currentTime)}),this.player.bindEvent(this.player.Events.TRIMMING_CHANGED,async i=>{const s=i.end-i.start;h(this,x).setDuration(s);const a=await this.player.videoContainer.currentTime();h(this,x).setCurrentTime(a)}),this.onResize()}async unload(){this.removeFromParent(),await Oi(this.player,"button"),h(this,fe).innerHTML="",h(this,ye).innerHTML=""}hideUserInterface(){this.player.log.debug("Hide playback bar user interface"),this.hide()}showUserInterface(){var t;if(h(this,le)){const s=((t=this.player.config.progressIndicator)==null?void 0:t.inlineMode)??!1?"flex":"block";this.show(s),this.onResize()}}get buttonPluginsRight(){return h(this,ye)}get buttonPluginsLeft(){return h(this,fe)}get progressIndicator(){return h(this,x)}get containerSize(){const t=this.element.clientWidth,i=this.element.clientHeight;return{width:t,height:i}}onResize(){const{containerSize:t}=this;h(this,ve).forEach(i=>i.onResize(t))}}ke=new WeakMap,ge=new WeakMap,me=new WeakMap,Z=new WeakMap,fe=new WeakMap,Ae=new WeakMap,ye=new WeakMap,x=new WeakMap,le=new WeakMap,ve=new WeakMap;const zi=[{maxWidth:400,className:"size-s"},{maxWidth:600,className:"size-m"},{maxWidth:900,className:"size-l"},{maxWidth:1100,className:"size-xl"},{className:"size-xxl"}],As=n=>zi.find(e=>e.maxWidth&&e.maxWidth>=n||e.maxWidth===void 0).className;class Ms extends O{constructor(e,t){const i={class:"captions-canvas visible-ui"};super(e,{tag:"div",attributes:i,parent:t}),this._captionsContainer=b(`
            <div class="text-container">
            </div>
        `,this.element),this._captions=[],this.hide(),this._currentCaptions=null;const s=async a=>{const o=(e.videoContainer.isTrimEnabled?e.videoContainer.trimStart:0)+(a.currentTime||a.newTime||0);if(this._currentCaptions){const l=this._currentCaptions.getCue(o);this._captionsContainer.innerHTML="",l&&l.captions.forEach(d=>{this._captionsContainer.innerHTML+=d,this._captionsContainer.innerHTML+="<br/>"}),l?this._captionsContainer.style.display=null:this._captionsContainer.style.display="none",this.resize()}};T(this.player,p.TIMEUPDATE,s),T(this.player,p.SEEK,s),T(this.player,p.RESIZE,()=>this.resize()),T(this.player,p.SHOW_UI,()=>this.element.classList.add("visible-ui")),T(this.player,p.HIDE_UI,()=>this.element.classList.remove("visible-ui"))}async load(){await wn(this.player)}unload(){}resize(){const e=As(this._captionsContainer.clientWidth);zi.forEach(t=>this.element.classList.remove(t.className)),this.element.classList.add(e)}addCaptions(e){this._captions.push(e),E(this.player,p.CAPTIONS_CHANGED,{captions:this._captions})}get captions(){return this._captions}get currentCaptions(){return this._currentCaptions}getCaptions({label:e,index:t,lang:i}){if(e===void 0&&t===void 0&&i===void 0)throw Error("Could not find captions: you must specify the label, the index or the language");return t!==void 0?this._captions[t]:this._captions.find(s=>{if(e!==void 0)return s.label===e;if(i!==void 0)return s.language===i})}enableCaptions(e){const t=this.getCaptions(e);if(t!==this._currentCaptions&&(this._currentCaptions=t,this.currentCaptions)){const{language:i,label:s}=this.currentCaptions;E(this.player,p.CAPTIONS_ENABLED,{language:i,label:s})}this.show()}disableCaptions(){this.currentCaptions&&E(this.player,p.CAPTIONS_DISABLED),this._currentCaptions=null,this.hide()}}async function Rs(n){await V(n,"eventLog",async e=>{e.events.forEach(t=>{T(n,t,async i=>{await e.onEvent(t,i)})})})}async function xs(n){}class Vs extends se{get type(){return"eventLog"}get events(){return[]}async onEvent(e,t){this.player.log.warn(`${this.name}: onEvent() function is not overwritten.`)}}const Dt=n=>!1,kt=n=>n.description;class Us{constructor(e,t){this._player=e,this._cookieConsentData=e.config.cookieConsent||[],this._getConsentCallback=t.getConsent||Dt,this._getDescriptionCallback=t.getDescription||kt,this._cookieConsentData.forEach(i=>{i.description=this._getDescriptionCallback(i)}),this.updateConsentData()}updateConsentData(){this._cookieConsentData.forEach(e=>{e.value=this._getConsentCallback(e.type)||e.required}),E(this._player,p.COOKIE_CONSENT_CHANGED,{cookieConsent:this})}getConsentForType(e){const t=this._cookieConsentData.find(i=>i.type===e);return(t==null?void 0:t.value)||!1}}function Hi({container:n}){n.innerHTML=`
        <div class="timeline-preview hidden">
            <img src="" alt="" />
            <p></p>
        </div>
    `;const e=n.querySelector("img"),t=n.querySelector("p"),i=n.querySelector(".timeline-preview");return{setImage(a,r){a!==e.src&&(e.src=a,e.alt=r)},setText(a){t.innerText=a},setPosition(a){a>.5?(i.style.left="",i.style.right=`${100-a*100}%`):(i.style.right="",i.style.left=`${a*100}%`)},show(){i.classList.remove("hidden")},hide(){i.classList.add("hidden")}}}function Ns({container:n,player:e,duration:t=100,currentTime:i=0,precision:s=100}){n.classList.add("progress-indicator"),n.classList.add("custom-progress-indicator"),n.innerHTML=`
        <div class="range-container">
            <div class="timeline-preview-container"></div>
            <div class="elapsed"></div>
            <div class="remaining"></div>
            <input type="range" min="0" max="${t*s}" value="${i*s}" tabindex="0" role="slider" class="slider">
            <ul class="markers-container"></ul>
        </div>
    `;const a=n.querySelector(".elapsed"),r=n.querySelector(".remaining"),o=n.querySelector(".slider"),l=n.querySelector(".timeline-preview-container"),d=Hi({container:l});let y=!1,g=null;const m=[],_=u=>{var v;return(v=m.find(S=>S.time<u&&S.time+S.frameDuration>=u))==null?void 0:v.marker},L={player:e,elapsed:a,remaining:r,range:o,timeLinePreview:d,markersContainer:n.querySelector(".markers-container"),addMarker({time:u,duration:v,frameDuration:S}){const f=b(`<li>
                <div class="elapsed"></div>
                <div class="remaining"></div>
            </li>`);f.style.left=`${u/v*100}%`,f.style.width=`calc(${S/v*100}% - 4px)`,this.markersContainer.appendChild(f),m.push({marker:f,time:u,frameDuration:S})},updateRemaining(){const u=this.range.value/this.range.max*100;this.elapsed.style.width=`${u}%`,this.remaining.style.width=`${100-u}%`;const v=_(this.range.value/s),S=m.findIndex(f=>f.marker===v);m.forEach((f,K)=>{if(K<S)f.marker.querySelector(".elapsed").style.width="100%",f.marker.querySelector(".remaining").style.width="0%";else if(K===S){const ce=(this.range.value/s-f.time)/f.frameDuration*100;f.marker.querySelector(".elapsed").style.width=`${ce}%`,f.marker.querySelector(".remaining").style.width=`${100-ce}%`}else f.marker.querySelector(".elapsed").style.width="0%",f.marker.querySelector(".remaining").style.width="100%"})},setDuration(u){y||(this.range.max=u*s,this.updateRemaining())},setCurrentTime(u){y||(this.range.value=u*s,this.updateRemaining())},onChange(u){g=u}};o.addEventListener("pointerdown",()=>{y=!0});let P=null;o.addEventListener("mousemove",async u=>{var S;const v=((S=e.frameList)==null?void 0:S.frames)||[];if(v.length){const f=await e.videoContainer.duration(),K=u.target.clientWidth,J=u.layerX/K,X=J*f,B=v.filter(Ys=>Ys.time<=X).pop(),Qs=B&&(B.thumb||B.url),nn=B&&te(f*J),ze=_(X);ze!==P&&P!==null&&P.classList.remove("active"),ze&&ze.classList.add("active"),P=ze,d.setImage(Qs,nn),d.setText(nn),d.setPosition(J),d.show()}}),o.addEventListener("mouseleave",()=>{d.hide(),P&&P.classList.remove("active")}),o.addEventListener("pointerup",()=>{y=!1,typeof g=="function"&&g(o.value/s)}),o.addEventListener("input",()=>{L.updateRemaining()});const C=async u=>{const v=await e.videoContainer.currentTime();await e.videoContainer.setCurrentTime(v+u)};return o.addEventListener("keydown",u=>{u.key==="ArrowLeft"?(C(-10),u.preventDefault(),u.stopPropagation()):u.key==="ArrowRight"&&(C(10),u.preventDefault(),u.stopPropagation())}),L.updateRemaining(),L}const D=Object.freeze({DISABLED:0,ERROR:1,WARN:2,INFO:3,DEBUG:4,VERBOSE:5});let ji=D.INFO;const Wi=(n,e=null)=>{const t=typeof n=="string"?D[n.toUpperCase()]:n;if(t<D.DISABLED||t>D.VERBOSE)throw Error(`setLogLevel: invalid log level ${t}`);e?(e.__logSettings=e.__logSettings||{},e.__logSettings.logLevel=t):ji=t},qi=(n=null)=>n?n.__logSettings.logLevel:ji,Se=({msg:n,level:e=D.INFO,player:t=null,context:i="paella-core"})=>{t&&!t.__logSettings&&Wi(t,D.INFO);const s=qi(t);if(e<D.DISABLED)throw Error(`printMessage: invalid log level ${e}`);if(t&&E(t,p.LOG,{severity:e,context:i,message:n,currentLogLevel:s}),e<=s)switch(e){case D.ERROR:console.error(`${i} - Error: ${n}`);break;case D.WARN:console.warn(`${i} - Warning: ${n}`);break;case D.INFO:console.info(`${i} - Info: ${n}`);break;case D.DEBUG:console.debug(`${i} - Debug: ${n}`);break;case D.VERBOSE:console.log(`${i} - Verbose: ${n}`);break}},q={setLevel:(n,e=null)=>{Wi(n,e)},currentLevel:(n=null)=>qi(n),error:(n,e=null,t="paella-core")=>{Se({msg:n,level:D.ERROR,player:e,context:t})},warn:(n,e=null,t="paella-core")=>{Se({msg:n,level:D.WARN,player:e,context:t})},info:(n,e=null,t="paella-core")=>{Se({msg:n,level:D.INFO,player:e,context:t})},debug:(n,e=null,t="paella-core")=>{Se({msg:n,level:D.DEBUG,player:e,context:t})},verbose:(n,e=null,t="paella-core")=>{Se({msg:n,level:D.VERBOSE,player:e,context:t})}};class Qi{constructor(e,t="paella-core"){this._player=e,this._context=t}get context(){return this._context}get player(){return this._player}setLevel(e){q.setLevel(e,this._player)}currentLevel(){return q.currentLevel(this._player)}error(e,t=null){q.error(e,this._player,t||this._context)}warn(e,t=null){q.warn(e,this._player,t||this._context)}info(e,t=null){q.info(e,this._player,t||this._context)}debug(e,t=null){q.debug(e,this._player,t||this._context)}verbose(e,t=null){q.verbose(e,this._player,t||this._context)}}const Yi={},At='{ "global": {}, "videos": {} }';async function Zi(){switch(this.source.name){case"cookie":try{return JSON.parse(j("preferences"))}catch{return JSON.parse(At)}case"dataPlugin":try{return await this.player.data.read(this.source.context,{})||JSON.parse(At)}catch{return JSON.parse(At)}}}async function Fs(n){switch(this.source.name){case"cookie":Bt(this.player,this.source.consentType,"preferences",JSON.stringify(n));break;case"dataPlugin":await this.player.data.write(this.source.context,{},n);break}}class Os extends ne{constructor(e){super(e);const{currentSource:t,sources:i}=e.config.preferences||{currentSource:"cookie",sources:{cookie:{consentType:"necessary"}}};if(this.source=i[t],this.source.name=t,this._loaded=!1,!this.source)throw Error("Invalid configuration in preferences. Check the configuration file.")}async set(e,t,{global:i=!1}={}){const s=await Zi.apply(this);i?s.global[e]=t:(s.videos[this.player.videoId]=s.videos[this.player.videoId]||{},s.videos[this.player.videoId][e]=t),await Fs.apply(this,[s])}async get(e,{global:t=!1}={}){const i=await Zi.apply(this);return t?i.global[e]:i.videos[this.player.videoId]&&i.videos[this.player.videoId][e]||void 0}}function $s(n){var e;(e=this._skinData)!=null&&e.configOverrides&&_e(n,this._skinData.configOverrides)}async function Bs(){var n;if((n=this._skinData)!=null&&n.styleSheets){const e=[];this._skinData.styleSheets.forEach(t=>{if(!/\{.*/.test(t))if(this._externalResourcesAllowed){const i=G([this._skinUrl,t]);e.push(new Promise(async s=>{await qe(i,!1),s()}))}else throw new Error("No external resources allowed loading skin object")}),await Promise.allSettled(e)}}async function Gs(){var n;if(this.player.__skinStyleSheets__=this.player.__skinStyleSheets__||[],(n=this._skinData)!=null&&n.styleSheets){const e=[];this._skinData.styleSheets.forEach(t=>{if(/\{.*/.test(t))e.push(new Promise(i=>{const s=document.createElement("style");s.innerHTML=t,this.player.__skinStyleSheets__.push(s),document.head.appendChild(s),i()}));else{const i=G([this._skinUrl,t]);e.push(new Promise(async s=>{const a=await qe(i);this.player.__skinStyleSheets__.push(a),s()}))}}),await Promise.allSettled(e)}}function Ki(){this.player.__skinStyleSheets__=this.player.__skinStyleSheets__||[],this.player.__skinStyleSheets__.forEach(n=>{Gt(n)}),this.player.__skinStyleSheets__=[]}async function zs(){var n;Array.isArray((n=this._skinData)==null?void 0:n.icons)&&await Promise.all(this._skinData.icons.map(({plugin:e,identifier:t,icon:i})=>new Promise(async(s,a)=>{const r=document.createElement("div");if(r.innerHTML=i,r.children[0]&&r.children[0].tagName==="svg")s();else if(this._externalResourcesAllowed){const o=G([this._skinUrl,i]);(await fetch(o)).ok?s():a(new Error(`Skin icon not found at URL '${o}'`))}else throw new Error("No external resources allowed loading skin object")})))}async function Hs(){var n;Array.isArray((n=this._skinData)==null?void 0:n.icons)&&await Promise.all(this._skinData.icons.map(({plugin:e,identifier:t,icon:i})=>new Promise(async(s,a)=>{const r=document.createElement("div");if(r.innerHTML=i,r.children[0]&&r.children[0].tagName==="svg")this.player.addCustomPluginIcon(e,t,i),s();else{const o=G([this._skinUrl,i]),l=await fetch(o);if(l.ok){const d=await l.text();this.player.addCustomPluginIcon(e,t,d),s()}else a(new Error(`Skin icon not found at URL '${o}'`))}})))}class js{constructor(e){this._player=e}get player(){return this._player}async loadSkin(e){if(typeof e=="string"){this._skinUrl=He(e),this._externalResourcesAllowed=!0;const t=await fetch(e);if(!t.ok)throw new Error(`Error loading skin from URL ${e}`);this._skinData=await t.json()}else typeof e=="object"&&(this._skinUrl="",this._externalResourcesAllowed=!1,this._skinData=e);try{await Bs.apply(this),await zs.apply(this),(this._player.state===w.LOADED||this._player.state===w.MANIFEST)&&await this._player.reload()}catch(t){throw this._skinUrl="",this._externalResourcesAllowed=!0,this._skinData={},t}}unloadSkin(){var e,t;Array.isArray((e=this._skinData)==null?void 0:e.icons)&&((t=this._skinData)==null||t.icons.forEach(({plugin:i,identifier:s})=>{this.player.removeCustomPluginIcon(i,s)})),this._skinUrl=null,this._skinData={},(this._player.state===w.LOADED||this._player.state===w.MANIFEST)&&this._player.reload()}}class Ji{constructor(e,t){this._player=t,this._videoManifest=JSON.parse(JSON.stringify(e)),this._metadata=this._videoManifest.metadata||{},this._streams={},this._frameList={},this._trimming=this._videoManifest.trimming,this._captions=this._videoManifest.captions,this._visibleTimeLine=this._videoManifest.visibleTimeLine;function i(){if(this.streams.length!==1)return null;if(this.isAudioOnly)return this.audioOnlySource.src;const s=this.streams[0];if(!(s.sources.mp4||s.sources.hls||s.sources.hlsLive))return null;const r=document.createElement("video");if(s.sources.mp4&&s.sources.mp4.length&&r.canPlayType(s.sources.mp4[0].mimetype||"video/mp4")==="probably")return s.sources.mp4[0].src;const o=s.sources.hls||s.sources.hlsLive;return o&&o.length&&r.canPlayType(o[0].mimetype||"application/vnd.apple.mpegurl")!==""&&/safari/i.test(navigator.userAgent)?o[0].src:null}this._streams={streams:this._videoManifest.streams,get contents(){return this.streams.map(s=>s.content)},getStream(s){return this.streams.find(a=>a.content===s)},getSourceTypes(s){const a=this.getStream(s);return a&&Object.keys(a.sources)||null},getCanvasTypes(s){const a=this.getStream(s);return a?a.canvas||["video"]:null},get isAudioOnly(){const s=this.contents.length===1&&this.contents[0],a=s&&this.getCanvasTypes(s)||[],r=this.getStream(s);return a.length===1&&a[0]==="audio"&&r.sources.audio&&r.sources.audio.length>0},get audioOnlySource(){return this.isAudioOnly?this.getStream(this.contents[0]).sources.audio[0]:null},get isNativelyPlayable(){return i.apply(this)!==null},get nativeSource(){return i.apply(this)},get nativeType(){return this.isNativelyPlayable?this.isAudioOnly?"audio":"video":null},get nativePlayer(){const s=this.nativeType;if(s){const a=document.createElement(s);return a.src=this.nativeSource,a}else return null}},this._videoManifest.frameList&&!Array.isArray(this._videoManifest.frameList)&&typeof this._videoManifest.frameList=="object"&&typeof this._videoManifest.frameList.targetContent=="string"&&Array.isArray(this._videoManifest.frameList.frames)?this._frameList=this._videoManifest.frameList:Array.isArray(this._videoManifest.frameList)?this._frameList={targetContent:null,frames:this._videoManifest.frameList}:this._frameList={targetContent:null,frames:[]},this._frameList.frames.sort((s,a)=>s.time-a.time),this._frameList.getImage=(s,a=!1)=>{var r,o;return(r=this._player)!=null&&r.videoContainer&&this._player._videoContainer.isTrimEnabled&&!a?s+=this._player.videoContainer.trimStart:!((o=this._player)!=null&&o._videoContainer)&&!a&&console.warn("frameList.getImage(): player instance is null. The trimming information will be ignored."),[...this._frameList.frames].sort((l,d)=>d.time-l.time).find(l=>l.time<s)},Object.defineProperty(this._frameList,"isEmpty",{get(){return Array.isArray(e.frameList)&&e.frameList.length===0||!e.frameList}}),Object.freeze(this._metadata),Object.freeze(this._streams),Object.freeze(this._trimming),Object.freeze(this._captions)}get metadata(){return this._metadata}get streams(){return this._streams}get frameList(){return this._frameList}get captions(){return this._captions}get trimming(){return this._trimming}get visibleTimeLine(){return this._visibleTimeLine}}const N=Object.freeze(["UNLOADED","LOADING_MANIFEST","MANIFEST","LOADING_PLAYER","LOADED","UNLOADING_MANIFEST","UNLOADING_PLAYER","ERROR"]);function Xi(){var t,i,s,a,r,o,l,d;const n=((i=(t=this.videoManifest)==null?void 0:t.metadata)==null?void 0:i.preview)&&H(this,(a=(s=this.videoManifest)==null?void 0:s.metadata)==null?void 0:a.preview)||this.defaultVideoPreview,e=((o=(r=this.videoManifest)==null?void 0:r.metadata)==null?void 0:o.previewPortrait)&&H(this,(d=(l=this.videoManifest)==null?void 0:l.metadata)==null?void 0:d.previewPortrait)||this.defaultVideoPreviewPortrait;this._previewContainer=new Es(this,this._containerElement,n,e)}async function en(){this._playerState=w.LOADING_MANIFEST,this._manifestLoaded=!0,this.log.debug("Loading paella player"),this._config=await this.initParams.loadConfig(this.configUrl,this),$s.apply(this.skin,[this._config]),Tn(this),this._defaultVideoPreview=this._config.defaultVideoPreview||this._initParams.defaultVideoPreview||"",this._defaultVideoPreviewPortrait=this._config.defaultVideoPreviewPortrait||this._initParams.defaultVideoPreviewPortrait||"",this._cookieConsent=new Us(this,{getConsent:this._initParams.getCookieConsentFunction,getDescription:this._initParams.getCookieDescriptionFunction}),this._preferences=new Os(this);const n=new URLSearchParams(window.location.search),e=new URLSearchParams;for(const[s,a]of n)e.append(s.toLowerCase(),a);const t=e.get("loglevel"),i=t&&Array.from(Object.keys(D)).indexOf(t.toUpperCase())!==-1?t:this._config.logLevel||"INFO";this._log.setLevel(i),await this._initParams.loadDictionaries(this),ds(this),await Rs(this),this._videoContainer=new _s(this,this._containerElement),await this.videoContainer.create();for(const s of this.pluginModules){const a=s.getDictionaries&&await s.getDictionaries();if(a)for(const r in a)pe(r,a[r])}}async function tn(){var n,e;this.log.debug("Video manifest loaded:"),this.log.debug(this.videoManifest),this._data=new xi(this);for(const t in Yi){const i=Yi[t];pe(t,i)}if(this._playerState=w.MANIFEST,E(this,p.MANIFEST_LOADED),(e=(n=this.videoManifest)==null?void 0:n.metadata)!=null&&e.preview)Xi.apply(this);else throw new Error("No preview image found in video manifest, and no default preview image defined.");$i(this._videoManifest)}class Ws{constructor(e,t={}){this._log=new Qi(this),this._packageData=be,this._log.setLevel(D.VERBOSE),window.__paella_instances__=window.__paella_instances__||[],window.__paella_instances__.push(this),this.log.debug("New paella player instance"),typeof e=="string"&&(e=document.getElementById(e)),e.classList.add("player-container"),this.log.debug("Loading skin manager"),this._skin=new js(this),this._containerElement=e,this._initParams=t,this._initParams.manifestFileName=this._initParams.manifestFileName||"data.json",this._initParams.loadConfig=this._initParams.loadConfig||Ht,this._initParams.getVideoId=this._initParams.getVideoId||jt,this._initParams.getManifestUrl=this._initParams.getManifestUrl||Wt,this._initParams.getManifestFileUrl=this._initParams.getManifestFileUrl||qt,this._initParams.loadVideoManifest=this._initParams.loadVideoManifest||Qt,this._initParams.customPluginContext=this._initParams.customPluginContext||[],this._initParams.translateFunction=this._initParams.translateFunction||st,this._initParams.getLanguageFunction=this._initParams.getLanguageFunction||rt,this._initParams.setLanguageFunction=this._initParams.setLanguageFunction||at,this._initParams.addDictionaryFunction=this._initParams.addDictionaryFunction||ot,this._initParams.getDictionariesFunction=this._initParams.getDictionariesFunction||lt,this._initParams.getDefaultLanguageFunction=this._initParams.getDefaultLanguageFunction||ct,this._initParams.Loader=this._initParams.customLoader||Yt,this._initParams.getCookieConsentFunction=this._initParams.getCookieConsentFunction||Dt,this._initParams.getCookieDescriptionFunction=this._initParams.getCookieDescriptionFunction||kt,this._initParams.getProgressIndicator=this._initParams.getProgressIndicator||Ns,this._initParams.loadDictionaries=this._initParams.loadDictionaries||async function(a){pe("en",{Hello:"Hello",World:"World"}),pe("es",{Hello:"Hola",World:"Mundo"}),ut(navigator.language.substring(0,2))};const i=this._initParams.plugins||[];this._initParams.plugins=[...i],Cn(this._initParams.translateFunction),bn(this._initParams.setLanguageFunction),Ln(this._initParams.getLanguageFunction),Pn(this._initParams.addDictionaryFunction),En(this._initParams.getDictionariesFunction),Sn(this._initParams.getDefaultLanguageFunction),this._config=null,this._defaultVideoPreview="",this._defaultVideoPreviewPortrait="",this._videoId=null,this._manifestUrl=null,this._manifestFileUrl=null,this._manifestData=null,this._videoManifest=null,this._playerLoaded=!1;const s=()=>{this.resize()};window.addEventListener("resize",s),this.containerElement.addEventListener("fullscreenchange",()=>{E(this,p.FULLSCREEN_CHANGED,{status:this.isFullscreen}),this.isFullscreen?E(this,p.ENTER_FULLSCREEN):E(this,p.EXIT_FULLSCREEN)}),this._playerState=w.UNLOADED,this._customPluginIcons={}}get version(){return this._packageData.version}get pluginModules(){return this.__pluginModules||[]}get log(){return this._log}get ready(){return this._playerState===w.LOADED}get state(){return this._playerState}get stateText(){return N[this.state]}get Events(){return p}get preferences(){return this._preferences}get skin(){return this._skin}get containsFocus(){return this.containerElement.contains(document.activeElement)}translate(e,t=null){return he(e,t)}setLanguage(e){ut(e)}getLanguage(){return fi()}addDictionary(e,t){pe(e,t)}getDictionaries(){return yi()}getDefaultLanguage(){return dt(this)}bindEvent(e,t,i=!0){T(this,e,s=>t(s),i)}getShortcuts(){return getShortcuts(this)}pauseCaptureShortcuts(){return pauseCaptureShortcuts(this)}resumeCaptureShortcuts(){return resumeCaptureShortcuts(this)}getPlugin(e,t=null){if(t){const i=this.__pluginData__.pluginInstances[t];if(i)return i.find(s=>{if(s.name===e)return s})}else{const i={};for(const s in this.__pluginData__.pluginInstances){const r=this.__pluginData__.pluginInstances[s].find(o=>{if(o.name===e)return o});r&&(i[s]=r)}return i}}get hideUiTime(){return this._hideUiTime}set hideUiTime(e){this._hideUiTime=e}get containerSize(){return{w:this._containerElement.offsetWidth,h:this._containerElement.offsetHeight}}get containerElement(){return this._containerElement}get initParams(){return this._initParams}get cookieConsent(){return this._cookieConsent}get configLoaded(){return this.configUrl!==null}get videoManifestLoaded(){return this.videoManifest!==null}get videoLoaded(){var e;return((e=this.videoContainer)==null?void 0:e.ready)||!1}get playerLoaded(){return this._playerLoaded}get configResourcesUrl(){var e;return((e=this._initParams)==null?void 0:e.configResourcesUrl)||"config/"}get configUrl(){var e;return((e=this._initParams)==null?void 0:e.configUrl)||"config/config.json"}get config(){return this._config}get defaultVideoPreview(){return this._defaultVideoPreview}get defaultVideoPreviewPortrait(){return this._defaultVideoPreviewPortrait}get videoId(){return this._videoId}get repositoryUrl(){var e,t;return((e=this._initParams)==null?void 0:e.repositoryUrl)||((t=this.config)==null?void 0:t.repositoryUrl)||""}get manifestUrl(){return this._manifestUrl}get manifestFileName(){var e,t;return((e=this.config)==null?void 0:e.manifestFileName)||((t=this._initParams)==null?void 0:t.manifestFileName)||""}get manifestFileUrl(){return this._manifestFileUrl}get videoManifest(){return this._videoManifest}get previewContainer(){return this._previewContainer}get videoContainer(){return this._videoContainer}get playbackBar(){return this._playbackBar}get captionsCanvas(){return this._captionsCanvas}get data(){return this._data}get PlayerState(){return w}get PlayerStateNames(){return N}get metadata(){var e;return((e=this._manifestParser)==null?void 0:e.metadata)||{}}get streams(){var e;return((e=this._manifestParser)==null?void 0:e.streams)||[]}get frameList(){var e;return((e=this._manifestParser)==null?void 0:e.frameList)||{}}get captions(){var e;return((e=this._manifestParser)==null?void 0:e.captions)||[]}get trimming(){var e;return((e=this._manifestParser)==null?void 0:e.trimming)||{}}get visibleTimeLine(){var e;return((e=this._manifestParser)==null?void 0:e.visibleTimeLine)||!0}waitState(e){return new Promise((t,i)=>{const s=()=>{this.state===e?t():setTimeout(s,50)};typeof e=="string"&&(e=w[e]),(e<0||e>Object.values(w).length)&&i(Error(`Invalid player state '${e}'`)),s()})}async loadUrl(e,{title:t,duration:i,preview:s,previewPortrait:a}={}){if(this._playerState!==w.UNLOADED)throw new Error(this.translate("loadUrl(): Invalid current player state: $1",[N[this._playerState]]));if(this._manifestLoaded)throw new Error(this.translate("loadUrl(): Invalid current player state: $1",[N[this._playerState]]));if(!e)throw new Error(this.translate("loadUrl(): No URL specified."));Array.isArray(e)||(e=[e]),t||(t=Me(e[0]),this.log.warn("Paella.loadUrl(): no title specified. Using URL file name as video name."));try{if(await en.apply(this),!s&&(this.defaultVideoPreview!==""||this.defaultVideoPreviewPortrait!==""))s=this.defaultVideoPreview,a=this.defaultVideoPreviewPortrait,this.log.warn("Paella.loadUrl(): no preview image specified. Using default preview image.");else if(!s&&!a)throw new Error("Paella.loadUrl(): no preview image specified and no default preview image configured.");this._videoId=Ut(Me(e[0])),this._manifestUrl=He(e[0]),this._manifestFileUrl=e[0],this.log.debug(`Loading video with identifier '${this.videoId}' from URL '${this.manifestFileUrl}'`);const r=Vn(this,e.length)[0];this._videoManifest={metadata:{duration:i,title:t,preview:s,previewPortrait:a},streams:e.map((o,l)=>({sources:ms(this,o),content:r[l],role:l===0?"mainAudio":null}))},await tn.apply(this)}catch(r){throw this._playerState=w.ERROR,this.log.error(r),this._errorContainer=new Ze(this,this.translate(r.message)),r}}async loadManifest(){if(this._playerState!==w.UNLOADED)throw new Error(this.translate("loadManifest(): Invalid current player state: $1",[N[this._playerState]]));if(!this._manifestLoaded)try{if(await en.apply(this),this._videoId=await this.initParams.getVideoId(this._config,this),this.videoId===null)throw new Error("No video identifier specified");this._manifestUrl=await this.initParams.getManifestUrl(this.repositoryUrl,this.videoId,this._config,this),this._manifestFileUrl=await this.initParams.getManifestFileUrl(this._manifestUrl,this.manifestFileName,this._config,this),this.log.debug(`Loading video with identifier '${this.videoId}' from URL '${this.manifestFileUrl}'`),this._videoManifest=await this.initParams.loadVideoManifest(this.manifestFileUrl,this._config,this),this._videoManifest.metadata=this._videoManifest.metadata||{},!this._videoManifest.metadata.preview&&(this.defaultVideoPreview!==""||this.defaultVideoPreviewPortrait!=="")&&(this._videoManifest.metadata.preview=this.defaultVideoPreview,this._videoManifest.metadata.previewPortrait=this.defaultVideoPreviewPortrait,this.log.warn("Paella.loadUrl(): no preview image specified. Using default preview image.")),this._manifestParser=new Ji(this.videoManifest,this),Ki.apply(this.skin),await Hs.apply(this.skin),await Gs.apply(this.skin),await tn.apply(this)}catch(e){throw this._playerState=w.ERROR,this.log.error(e),this._errorContainer=new Ze(this,this.translate(e.message)),e}}async loadPlayer(){var e,t,i;try{if(this._captionsCanvas=new Ms(this,this._containerElement),this._playerState!==w.MANIFEST)throw new Error(this.translate("loadPlayer(): Invalid current player state: $1",[N[this._playerState]]));this._playerState=w.LOADING_PLAYER,(e=this._previewContainer)==null||e.removeFromParent(),this._loader=new this.initParams.Loader(this),await this._loader.create(),await this.videoContainer.load((t=this.videoManifest)==null?void 0:t.streams),E(this,p.STREAM_LOADED),this._playbackBar=new ks(this,this.containerElement),await this._playbackBar.load(),this._hideUiTime=((i=this.config.ui)==null?void 0:i.hideUITimer)??5e3,Ot(this),this._captionsCanvas.load(),this._playerState=w.LOADED,await this.videoContainer.updateLayout(),E(this,p.PLAYER_LOADED),!(this.videoManifest.metadata.visibleTimeLine??!0)&&this.playbackBar.progressIndicator.hideTimeLine(),this._loader.debug||(this._loader.removeFromParent(),this._loader=null)}catch(s){throw this._playerState=w.ERROR,this._loader&&(this._loader.removeFromParent(),this._loader=null),this._errorContainer=new Ze(this,s.message),s}}async load(){switch(this.state){case w.UNLOADED:await this.loadManifest(),await this.loadPlayer();break;case w.MANIFEST:await this.loadPlayer();break;case w.LOADED:break;default:throw new Error(this.translate("Could not load player: state transition in progress: $1",[N[this.state]]))}}async unload(){switch(this.state){case w.UNLOADED:break;case w.MANIFEST:await this.unloadManifest();break;case w.LOADED:case w.ERROR:await this.unloadPlayer(),await this.unloadManifest();break;default:throw new Error(this.translate("Could not unload player: state transition in progress: $1",[N[this.state]]))}}async unloadManifest(){var e;if(this._playerState!==w.MANIFEST&&this._playerState!==w.ERROR)throw new Error(this.translate("unloadManifest(): Invalid current player state: $1",[N[this._playerState]]));this._errorContainer&&(this._errorContainer.removeFromParent(),this._errorContainer=null),this._playerState=w.UNLOADING_MANIFEST,this.log.debug("Unloading paella player"),await xs(),await hs(this),this._manifestLoaded=!1,(e=this._previewContainer)==null||e.removeFromParent(),this._preferences=null,this._playerState=w.UNLOADED,Ki.apply(this.skin)}async unloadPlayer(){var e,t,i,s,a;if(this._playerState!==w.LOADED&&this._playerState!==w.ERROR)throw new Error(this.translate("unloadManifest(): Invalid current player state: $1",[N[this._playerState]]));this._errorContainer&&(this._errorContainer.removeFromParent(),this._errorContainer=null),this._playerState=w.UNLOADING_PLAYER,await((e=this._videoContainer)==null?void 0:e.unload()),this._videoContainer=null,await((t=this._playbackBar)==null?void 0:t.unload()),this._playbackBar=null,(i=this._captionsCanvas)==null||i.unload(),this._captionsCanvas=null,$t(this),E(this,p.PLAYER_UNLOADED),(a=(s=this.videoManifest)==null?void 0:s.metadata)!=null&&a.preview&&Xi.apply(this),rn(this),this._playerState=w.MANIFEST}async reload(e=null){switch(this.state){case w.UNLOADED:break;case w.MANIFEST:await this.unloadManifest();break;case w.LOADED:await this.unload();break}typeof e=="function"&&await e(),await this.load()}async resize(){var e,t;if((e=this.videoContainer)==null||e.updateLayout(),(t=this.playbackBar)==null||t.onResize(),this.videoContainer){const i=()=>({w:this.videoContainer.element.offsetWidth,h:this.videoContainer.element.offsetHeight});E(this,p.RESIZE,{size:i()}),this._resizeEndTimer&&clearTimeout(this._resizeEndTimer),this._resizeEndTimer=setTimeout(()=>{E(this,p.RESIZE_END,{size:i()})},1e3)}}async hideUserInterface(){var e,t,i;await((e=this.videoContainer)==null?void 0:e.paused())||(this._uiHidden=!0,(t=this.videoContainer)==null||t.hideUserInterface(),(i=this.playbackBar)==null||i.hideUserInterface(),E(this,p.HIDE_UI))}async showUserInterface(){var e,t;(e=this.videoContainer)==null||e.showUserInterface(),(t=this.playbackBar)==null||t.showUserInterface(),this._uiHidden&&E(this,p.SHOW_UI),this._uiHidden=!1}async play(){this.videoContainer.ready||await this.loadPlayer(),await this.videoContainer.play()}async pause(){var e;await((e=this.videoContainer)==null?void 0:e.pause())}async paused(){return this.videoContainer?this.videoContainer.paused():!0}async stop(){var e;await((e=this.videoContainer)==null?void 0:e.stop())}isFullScreenSupported(){return this.containerElement.requestFullscreen||this.containerElement.webkitRequestFullScreen}async enterFullscreen(){let e=null;return this.containerElement.requestFullscreen?e=this.containerElement.requestFullscreen():this.containerElement.webkitRequestFullScreen&&(this.log.debug("Safari enter fullscreen"),e=this.containerElement.webkitRequestFullScreen()),setTimeout(()=>this.resize(),500),e}async exitFullscreen(){if(document.exitFullscreen&&this.isFullscreen)return document.exitFullscreen();if(document.webkitCancelFullScreen&&this.isFullscreen)return this.log.debug("Safari exit fullscreen"),document.webkitCancelFullScreen()}get isFullscreen(){return document.fullscreenElement===this.containerElement||document.webkitFullscreenElement===this.containerElement}addCustomPluginIcon(e,t,i){this._customPluginIcons[`${e}-${t}`]=i}removeCustomPluginIcon(e,t){this._customPluginIcons[`${e}-${t}`]=null}getCustomPluginIcon(e,t){return this._requestedCustomIcons=this._requestedCustomIcons||[],this._requestedCustomIcons.find(i=>i.pluginName===e&&i.iconName===t)||this._requestedCustomIcons.push({pluginName:e,iconName:t}),this._customPluginIcons[`${e}-${t}`]}get requestedCustomIcons(){return this._requestedCustomIcons||[]}}class qs{constructor({id:e,name:t,groupId:i="",language:s="",selected:a=!1}){this._id=e,this._name=t,this._groupId=i,this._lang=s,this._selected=a}get id(){return this._id}get name(){return this._name}get groupId(){return this._groupId}get language(){return this._lang}get selected(){return this._selected}set selected(e){this._selected=e}}c.AudioOnlyVideo=Jt,c.AudioTrackData=qs,c.AudioVideoPlugin=Xt,c.ButtonGroupPlugin=Fi,c.ButtonPlugin=Oe,c.Canvas=ft,c.CanvasButtonPlugin=On,c.CanvasButtonPosition=I,c.CanvasPlugin=yt,c.Captions=et,c.CaptionsPlugin=Xe,c.CurrentTimeLabelPlugin=Li,c.DFXPParser=oi,c.Data=xi,c.DataPlugin=Lt,c.DfxpManifestCaptionsPlugin=li,c.DomClass=O,c.DualVideoDynamicLayoutPlugin=wt,c.DualVideoLayoutPlugin=Ii,c.EventLogPlugin=Vs,c.Events=p,c.HtmlVideo=Je,c.HtmlVideoFormatPlugin=ei,c.ImageVideo=ni,c.ImageVideoFormatPlugin=si,c.LOG_LEVEL=D,c.Loader=Yt,c.Log=Qi,c.ManifestParser=Ji,c.MenuButtonPlugin=Ni,c.Mp4Video=ai,c.Mp4VideoFormatPlugin=ri,c.Paella=Ws,c.PaellaCorePlugins=ae,c.PlayPauseButtonPlugin=_i,c.PlayerResource=ne,c.PlayerState=w,c.PlayerStateNames=N,c.Plugin=se,c.PluginModule=Ce,c.PopUpButtonPlugin=Ui,c.SingleVideoLayoutPlugin=ki,c.TripleVideoLayoutPlugin=Ai,c.UserInterfacePlugin=Ne,c.Video=Ue,c.VideoCanvas=Mi,c.VideoCanvasPlugin=Ri,c.VideoContainerMessagePosition=U,c.VideoLayout=re,c.VideoPlugin=we,c.VideoQualityItem=ti,c.VttManifestCaptionsPlugin=bi,c.WebVTTParser=Ci,c.addDictionary=pe,c.bindEvent=T,c.checkManifestIntegrity=$i,c.createElement=Ye,c.createElementWithHtmlText=b,c.createTimeLinePreview=Hi,c.defaultAddDictionaryFunction=ot,c.defaultGetCookieConsentCallback=Dt,c.defaultGetCookieDescriptionCallback=kt,c.defaultGetDefaultLanguageFunction=ct,c.defaultGetDictionariesFunction=lt,c.defaultGetLanguageFunction=rt,c.defaultGetManifestFileUrlFunction=qt,c.defaultGetManifestUrlFunction=Wt,c.defaultGetVideoIdFunction=jt,c.defaultLoadConfigFunction=Ht,c.defaultLoadVideoManifestFunction=Qt,c.defaultSetLanguageFunction=at,c.defaultTranslateFunction=st,c.getDefaultLanguage=dt,c.getDictionaries=yi,c.getLanguage=fi,c.getPluginsOfType=Tt,c.importPlugins=us,c.isVolumeApiAvailable=Kt,c.loadPluginsOfType=V,c.log=q,c.parseDFXP=tt,c.parseWebVTT=ht,c.plugins=Vi,c.setLanguage=ut,c.translate=he,c.triggerEvent=E,c.triggerIfReady=ee,c.utils=cn,Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=paella-core.umd.cjs.map
